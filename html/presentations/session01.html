<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Session 01 &mdash; Internet Programming with Python</title>
    
    <link rel="stylesheet" href="../_static/pyramid.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="Internet Programming with Python" href="../index.html" />
    <link rel="up" title="Course Presentations" href="index.html" />
    <link rel="prev" title="Course Presentations" href="index.html" />
<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Neuton&amp;subset=latin" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Nobile:regular,italic,bold,bolditalic&amp;subset=latin" type="text/css" media="screen" charset="utf-8" />
<!--[if lte IE 6]>
<link rel="stylesheet" href="../_static/ie6.css" type="text/css" media="screen" charset="utf-8" />
<![endif]-->

  </head>
  <body>
<div class="header">
  <div class="logo">
    <a href="../index.html">
      <img class="logo" src="../_static/logo_UW.png" alt="Logo"/>
    </a>
  </div>
</div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="index.html" title="Course Presentations"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">UWPCE Python 200</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Course Presentations</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="session-01">
<h1>Session 01<a class="headerlink" href="#session-01" title="Permalink to this headline">¶</a></h1>
<a class="reference internal image-reference" href="../_images/python.png"><img alt="../_images/python.png" class="align-center" src="../_images/python.png" style="width: 43%;" /></a>
<div class="section" id="introductions">
<h2>Introductions<a class="headerlink" href="#introductions" title="Permalink to this headline">¶</a></h2>
<p class="large centered">Wherin we learn about the Model View Controller approach to app design and
explore data persistence in Python.</p>
<div class="section" id="but-first">
<h3>But First<a class="headerlink" href="#but-first" title="Permalink to this headline">¶</a></h3>
<div class="left container">
<p>Class presentations are available online for your use</p>
<p class="small"><a class="reference external" href="https://github.com/UWPCE-PythonCert/training.python_web">https://github.com/UWPCE-PythonCert/training.python_web</a></p>
<div class="build container">
<p>Licensed with Creative Commons BY-NC-SA</p>
<ul class="build simple">
<li>You must attribute the work</li>
<li>You may not use the work for commercial purposes</li>
<li>You have to share your versions just like this one</li>
</ul>
<p>Find mistakes? See improvements? Make a pull request.</p>
</div>
</div>
<p>The rendered documentation is available as well:</p>
<p><a class="reference external" href="http://uwpce-pythoncert.github.io">http://uwpce-pythoncert.github.io</a></p>
<p>Please check frequently. I will update with great regularity</p>
<p><strong>Classroom Protocol</strong></p>
<div class="build container">
<p>Questions to ask:</p>
<ul class="build simple">
<li>What did you just say?</li>
<li>Please explain what we just did again?</li>
<li>How did that work?</li>
<li>Why didn&#8217;t that work for me?</li>
<li>Is that a typo?</li>
</ul>
</div>
<p><strong>Classroom Protocol</strong></p>
<div class="build container">
<p>Questions <strong>not</strong> to ask:</p>
<ul class="build simple">
<li><strong>Hypotheticals</strong>: What happens if I do X?</li>
<li><strong>Research</strong>: Can Python do Y?</li>
<li><strong>Syllabus</strong>: Are we going to cover Z in class?</li>
<li><strong>Marketing questions</strong>: please just don&#8217;t.</li>
<li><strong>Performance questions</strong>: Is Python fast enough?</li>
<li><strong>Unpythonic</strong>: Why doesn&#8217;t Python do it some other way?</li>
<li><strong>Show off</strong>: Look what I just did!</li>
</ul>
</div>
<p class="large center">Introductions</p>
</div>
</div>
<div class="section" id="working-with-virtualenv">
<h2>Working with Virtualenv<a class="headerlink" href="#working-with-virtualenv" title="Permalink to this headline">¶</a></h2>
<div class="large line-block">
<div class="line">For every</div>
<div class="line">add-on package installed</div>
<div class="line">in a system Python,</div>
<div class="line">the gods kill a kitten</div>
<div class="line"><br /></div>
<div class="line">- me</div>
</div>
<div class="section" id="why-virtualenv">
<h3>Why Virtualenv?<a class="headerlink" href="#why-virtualenv" title="Permalink to this headline">¶</a></h3>
<ul class="build simple">
<li>You will need to install packages that aren&#8217;t in the Python standard
Library</li>
<li>You often need to install <em>different</em> versions of the <em>same</em> library for
different projects</li>
<li>Conflicts arising from having the wrong version of a dependency installed can
cause long-term nightmares</li>
<li>Use <a class="reference external" href="http://www.virtualenv.org/">virtualenv</a> ...</li>
<li><strong>Always</strong></li>
</ul>
</div>
<div class="section" id="installing-virtualenv">
<h3>Installing Virtualenv<a class="headerlink" href="#installing-virtualenv" title="Permalink to this headline">¶</a></h3>
<p>The best way is to install directly in your system Python (one exception to the
rule).</p>
<div class="build container">
<p>To do so you will have to have <a class="reference external" href="https://pip.pypa.io/en/latest/index.html">pip</a> installed.</p>
<p>Try the following command:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>which pip
/usr/local/bin/pip
</pre></div>
</div>
<p>If the <tt class="docutils literal"><span class="pre">which</span></tt> command returns no value for you, then <tt class="docutils literal"><span class="pre">pip</span></tt> is not
installed in your system. To fix this, follow <a class="reference external" href="https://pip.pypa.io/en/latest/installing.html">the instructions here</a>.</p>
</div>
<p>Once you have <tt class="docutils literal"><span class="pre">pip</span></tt> installed in your system, you can use it to install
<a class="reference external" href="http://www.virtualenv.org/">virtualenv</a>.</p>
<div class="build container">
<p>Because you are installing it into your system python, you will most likely
need <tt class="docutils literal"><span class="pre">superuser</span></tt> privileges to do so:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>sudo pip install virtualenv
Downloading/unpacking virtualenv
  Downloading virtualenv-1.11.2-py2.py3-none-any.whl <span class="o">(</span>2.8MB<span class="o">)</span>: 2.8MB downloaded
Installing collected packages: virtualenv
Successfully installed virtualenv
Cleaning up...
</pre></div>
</div>
</div>
<p>Great.  Once that&#8217;s done, you should find that you have a <tt class="docutils literal"><span class="pre">virtualenv</span></tt>
command available to you from your shell:</p>
<div class="highlight-bash"><div class="highlight"><pre>$ virtualenv --help
Usage: virtualenv [OPTIONS] DEST_DIR

Options:
  --version             show program&#39;s version number and exit
  -h, --help            ...
</pre></div>
</div>
</div>
<div class="section" id="using-virtuelenv">
<h3>Using Virtuelenv<a class="headerlink" href="#using-virtuelenv" title="Permalink to this headline">¶</a></h3>
<p>Creating a new virtualenv is very very simple:</p>
<div class="build container">
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>virtualenv <span class="o">[</span>options<span class="o">]</span> &lt;ENV&gt;
</pre></div>
</div>
<p><tt class="docutils literal"><span class="pre">&lt;ENV&gt;</span></tt> is just the name of the environment you want to create.</p>
<p>It&#8217;s arbitrary, so name them to be easily remembered.</p>
</div>
<p>Let&#8217;s make one for demonstration purposes:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>virtualenv demoenv
New python executable in demoenv/bin/python
Installing setuptools, pip...done.
</pre></div>
</div>
<p>When you ran that command, a couple of things took place:</p>
<ul class="build simple">
<li>A new directory with your requested name was created</li>
<li>A new Python executable was created in &lt;ENV&gt;/bin (&lt;ENV&gt;/Scripts on Windows)</li>
<li>The new Python was cloned from your system Python (where virtualenv was
installed)</li>
<li>The new Python was isolated from any libraries installed in the old Python</li>
<li>Setuptools was installed so you have <tt class="docutils literal"><span class="pre">easy_install</span></tt> for this new python</li>
<li>Pip was installed so you have <tt class="docutils literal"><span class="pre">pip</span></tt> for this new python</li>
</ul>
</div>
<div class="section" id="activation">
<h3>Activation<a class="headerlink" href="#activation" title="Permalink to this headline">¶</a></h3>
<p>Every virtualenv you create contains an executable Python command.</p>
<div class="build container">
<p>If you do a quick check to see which Python executable is found by your
terminal, you&#8217;ll see that it is not the one:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>which python
/usr/bin/python
</pre></div>
</div>
<p>You can execute the new Python by explicitly pointing to it:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>./demoenv/bin/python -V
Python 2.7.5
</pre></div>
</div>
</div>
<p>But that&#8217;s tedious and hard to remember.</p>
<div class="build container">
<p>Instead, <tt class="docutils literal"><span class="pre">activate</span></tt> your virtualenv using the <tt class="docutils literal"><span class="pre">source</span></tt> shell command:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span><span class="nb">source </span>demoenv/bin/activate
<span class="o">(</span>demoenv<span class="o">)</span><span class="nv">$ </span>which python
/Users/cewing/demoenv/bin/python
</pre></div>
</div>
<p>Notice that when a virtualenv is <em>active</em> you can see it in your command
prompt.</p>
<p>So long as the virtualenv is <em>active</em> the <tt class="docutils literal"><span class="pre">python</span></tt> executable that will
be used will be the new one in your <tt class="docutils literal"><span class="pre">demoenv</span></tt>.</p>
</div>
</div>
<div class="section" id="installing-packages">
<h3>Installing Packages<a class="headerlink" href="#installing-packages" title="Permalink to this headline">¶</a></h3>
<p>Since <tt class="docutils literal"><span class="pre">pip</span></tt> is also installed, the <tt class="docutils literal"><span class="pre">pip</span></tt> that is used to install new
software will also be the one in <tt class="docutils literal"><span class="pre">demoenv</span></tt>.</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="o">(</span>demoenv<span class="o">)</span><span class="nv">$ </span>which pip
/Users/cewing/demoenv/bin/pip
</pre></div>
</div>
<div class="build container">
<p>This means that using these tools to install packages will install them
<em>into your virtual environment only</em></p>
<p>The are not installed into the system Python.</p>
<p>Let&#8217;s see this in action.</p>
</div>
<p>We&#8217;ll install a package called <tt class="docutils literal"><span class="pre">docutils</span></tt></p>
<div class="build container">
<p>It provides tools for creating documentation using ReStructuredText</p>
<p>Install it using pip (while your virtualenv is active):</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="o">(</span>demoenv<span class="o">)</span><span class="nv">$ </span>pip install docutils
Downloading/unpacking docutils
  Downloading docutils-0.11.tar.gz <span class="o">(</span>1.6MB<span class="o">)</span>: 1.6MB downloaded
  Running setup.py <span class="o">(</span>path:/Users/cewing/demoenv/build/docutils/setup.py<span class="o">)</span> egg_info <span class="k">for </span>package docutils
    ...
    changing mode of /Users/cewing/demoenv/bin/rst2xml.py to 755
    changing mode of /Users/cewing/demoenv/bin/rstpep2html.py to 755
Successfully installed docutils
Cleaning up...
</pre></div>
</div>
</div>
<p>And now, when we fire up our Python interpreter, the docutils package is
available to us:</p>
<div class="highlight-pycon"><div class="highlight"><pre><span class="go">(demoenv)$ python</span>
<span class="go">Python 2.7.5 (default, Aug 25 2013, 00:04:04)</span>
<span class="go">[GCC 4.2.1 Compatible Apple LLVM 5.0 (clang-500.0.68)] on darwin</span>
<span class="go">Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">docutils</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">docutils</span><span class="o">.</span><span class="n">__path__</span>
<span class="go">[&#39;/Users/cewing/demoenv/lib/python2.7/site-packages/docutils&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="o">^</span><span class="n">d</span>
<span class="go">(demoenv)$</span>
</pre></div>
</div>
<p>Like some other Python libraries, the <tt class="docutils literal"><span class="pre">docutils</span></tt> package provides a number of
executable scripts when it is installed.</p>
<div class="build container">
<p>You can see these in the <tt class="docutils literal"><span class="pre">bin</span></tt> directory inside your virtualenv:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="o">(</span>demoenv<span class="o">)</span><span class="nv">$ </span>ls ./demoenv/bin
...
python
rst2html.py
rst2latex.py
...
</pre></div>
</div>
<p>These scripts are set up to execute using the Python with which they were
built.</p>
<p>Running these scripts will use the Python executable in your virtualenv,
<em>even if that virtualenv is not active</em>!</p>
</div>
</div>
<div class="section" id="deactivation">
<h3>Deactivation<a class="headerlink" href="#deactivation" title="Permalink to this headline">¶</a></h3>
<p>So you&#8217;ve got a virtual environment created and activated so you can work with
it.</p>
<div class="build container">
<p>Eventually you&#8217;ll need to stop working with this <tt class="docutils literal"><span class="pre">virtualenv</span></tt> and switch
to another</p>
<p>It&#8217;s a good idea to keep a separate <tt class="docutils literal"><span class="pre">virtualenv</span></tt> for every project you
work on.</p>
<p>When a <tt class="docutils literal"><span class="pre">virtualenv</span></tt> is active, all you have to do is use the
<tt class="docutils literal"><span class="pre">deactivate</span></tt> command:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="o">(</span>demoenv<span class="o">)</span><span class="nv">$ </span>deactivate
<span class="nv">$ </span>which python
/usr/bin/python
</pre></div>
</div>
<p>Note that your shell prompt returns to normal, and now the executable
Python found when you check <tt class="docutils literal"><span class="pre">python</span></tt> is the system one again.</p>
</div>
</div>
<div class="section" id="cleaning-up">
<h3>Cleaning Up<a class="headerlink" href="#cleaning-up" title="Permalink to this headline">¶</a></h3>
<p>The final advantage that <tt class="docutils literal"><span class="pre">virtualenv</span></tt> offers you as a developer is
the ability to easily remove a batch of installed Python software from your
system.</p>
<div class="build container">
<p>Consider a situation where you installed a library that breaks your Python
(it happens)</p>
<p>If you are working in your system Python, you now have to figure out what
that package installed</p>
<p>You have to figure out where it is</p>
<p>And you have to go clean it out manually.</p>
<p>With <tt class="docutils literal"><span class="pre">virtualenv</span></tt> you simply remove the directory <tt class="docutils literal"><span class="pre">virtualenv</span></tt> created
when you started out.</p>
</div>
<p>Let&#8217;s do that with our <tt class="docutils literal"><span class="pre">demoenv</span></tt>:</p>
<div class="build container">
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>rm -rf demoenv
</pre></div>
</div>
<p>And that&#8217;s it.</p>
<p>The entire environment and all the packages you installed into it are now
gone.</p>
<p>There are no traces left to pollute your world.</p>
</div>
<p>Let&#8217;s take a moment to rest up and absorb what we&#8217;ve learned.</p>
<p>When we return, we&#8217;ll begin talking about a particular approach to thinking
about application design:</p>
<p class="centered"><strong>Model View Controller</strong></p>
</div>
</div>
<div class="section" id="mvc-applications">
<h2>MVC Applications<a class="headerlink" href="#mvc-applications" title="Permalink to this headline">¶</a></h2>
<div class="figure align-center">
<a class="reference internal image-reference" href="http://upload.wikimedia.org/wikipedia/commons/4/40/MVC_passive_view.png"><img alt="http://upload.wikimedia.org/wikipedia/commons/4/40/MVC_passive_view.png" src="http://upload.wikimedia.org/wikipedia/commons/4/40/MVC_passive_view.png" style="width: 50%;" /></a>
<p class="caption">By Alan Evangelista (Own work) [CC0], via Wikimedia Commons</p>
</div>
<div class="section" id="separation-of-concerns">
<h3>Separation of Concerns<a class="headerlink" href="#separation-of-concerns" title="Permalink to this headline">¶</a></h3>
<div class="build container">
<p>In the first part of this course, you were introduced to the concept of
<em>Object Oriented Programming</em></p>
<p>OOP was <a class="reference external" href="http://en.wikipedia.org/wiki/Object-oriented_programming#History">first formalized</a> in the 1970s in <em>Smalltalk</em>, invented by Alan
Kay at <em>Xerox PARC</em></p>
<p><em>Smalltalk</em> was also the first language which utilized the
<a class="reference external" href="http://en.wikipedia.org/wiki/Model–view–controller">Model View Controller</a> design pattern.</p>
<p>This pattern (like all <a class="reference external" href="http://en.wikipedia.org/wiki/Software_design_pattern">design patterns</a>) seeks to provide a way of
thinking that helps to make software design easier.</p>
<p>In this case, the goal is to help clarify the high-level <em>separation of
concerns</em> in a system.</p>
</div>
</div>
<div class="section" id="three-components">
<h3>Three Components<a class="headerlink" href="#three-components" title="Permalink to this headline">¶</a></h3>
<p>The pattern divides the elements of a system into three parts:</p>
<dl class="build docutils">
<dt>Model:</dt>
<dd>This component represents the <em>data</em> that comprises the system, and the
<em>logic</em> used to manipulate that data.</dd>
<dt>View:</dt>
<dd><p class="first">This component can be any <em>representation</em> of the data to the outside world:
a chart, diagram, table, user interface, etc.</p>
<p class="last">It also includes representations of the <em>actions</em> available in the system.</p>
</dd>
<dt>Controller:</dt>
<dd><p class="first">This component coordinates the Model and the View in a system.</p>
<p>It accepts input from a user and channels that input into the Model.</p>
<p class="last">It accepts information about the current state of the Model and transmits
that information to the View.</p>
</dd>
</dl>
</div>
<div class="section" id="on-the-web">
<h3>On the Web<a class="headerlink" href="#on-the-web" title="Permalink to this headline">¶</a></h3>
<p>This pattern has proven useful for thinking about the applications we build for
the web.</p>
<div class="build container">
<p>A web browser provides a convenient container for <em>views</em> of data.</p>
<p>These <em>views</em> are created by <em>controller</em> software hosted on a server.</p>
<p>This <em>controller</em> software accepts input from users via <em>HTTP requests</em>,
channeling it into a <em>data model</em> usually stored in some database.</p>
<p>The <em>controller</em> returns information about the state of the <em>data model</em> to
the user via <em>HTTP responses</em></p>
</div>
<p>This approach is so common, that it has been formalized into any number of <em>web
frameworks</em></p>
<div class="build container">
<p><em>Web frameworks</em> abstract away the specifics of the <em>HTTP request/response
cycle</em>, leaving simple MVC components for the developer to use.</p>
<p><em>Web frameworks</em> exist in nearly all modern languages.</p>
<p>Python has scores of them.</p>
<p>Over the weeks to come, we&#8217;ll learn about two of them, <a class="reference external" href="http://www.pylonsproject.org/projects/pyramid/about">Pyramid</a> and
<a class="reference external" href="https://www.djangoproject.com/">Django</a>.</p>
</div>
</div>
<div class="section" id="a-word-about-terminology">
<h3>A Word About Terminology<a class="headerlink" href="#a-word-about-terminology" title="Permalink to this headline">¶</a></h3>
<p>Although the MVC pattern is a useful abstraction, there are a few differences
in how things are named in Python web frameworks</p>
<div class="build centered container">
<p>model &lt;&#8211;&gt; model</p>
<p>controller &lt;&#8211;&gt; view</p>
<p>view &lt;&#8211;&gt; template (or even HTTP response)</p>
<p class="left">For more on this difference, you can <a class="reference external" href="http://docs.pylonsproject.org/projects/pyramid/en/latest/designdefense.html#pyramid-gets-its-terminology-wrong-mvc">read this</a> from the Pyramid design
documentation.</p>
</div>
</div>
</div>
<div class="section" id="our-first-application">
<h2>Our First Application<a class="headerlink" href="#our-first-application" title="Permalink to this headline">¶</a></h2>
<p class="left">But enough abstract blabbering.</p>
<div class="build left container">
<p>There&#8217;s no better way to make concepts like these concrete than to build
something using them.</p>
<p>Let&#8217;s make an application!</p>
<p>We&#8217;re going to build a Learning Journal.</p>
<p>When we&#8217;re done, you&#8217;ll have a live, online application you can use to keep
note of the things you are learning about Python development.</p>
<p>We&#8217;ll use one of our Python web framework to do this: <a class="reference external" href="http://www.pylonsproject.org/projects/pyramid/about">Pyramid</a></p>
</div>
<div class="section" id="id1">
<h3>Pyramid<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>First published in 2010, <a class="reference external" href="http://www.pylonsproject.org/projects/pyramid/about">Pyramid</a> is a powerful, flexible web framework.</p>
<div class="build container">
<p>You can create compelling one-page applications, much like in
microframeworks like Flask</p>
<p>You can also create powerful, scalable applications using the full
power of Python</p>
<p>Created by the combined powers of the teams behind Pylons and Zope</p>
<p>It represents the first true second-generation web framework in
existence.</p>
</div>
</div>
<div class="section" id="starting-the-project">
<h3>Starting the Project<a class="headerlink" href="#starting-the-project" title="Permalink to this headline">¶</a></h3>
<p>The first step is to prepare for the project.</p>
<div class="build container">
<p>Begin by creating a location where you&#8217;ll do your work.</p>
<p>I generally put all my work in a folder called <tt class="docutils literal"><span class="pre">projects</span></tt> in my home
directory:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span><span class="nb">cd</span>
<span class="nv">$ </span>mkdir projects
<span class="nv">$ </span><span class="nb">cd </span>projects
<span class="nv">$ </span>mkdir learning-journal
<span class="nv">$ </span><span class="nb">cd </span>learning-journal
<span class="nv">$ </span><span class="nb">pwd</span>
/Users/cewing/project/learning-journal
</pre></div>
</div>
</div>
<p>We continue our preparations by creating a virtualenv we will use for it.</p>
<div class="build container">
<p>Again, this will help us to keep our work here isolated from anything else
we do.</p>
<p>Remember how to make a new virtualenv?</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>virtualenv ljenv
New python executable in ljenv/bin/python
Installing setuptools, pip...done.
</pre></div>
</div>
<p>And then, how to activate it?</p>
<div class="highlight-bash"><div class="highlight"><pre>$ source ljenv/bin/activate
(ljenv)$
</pre></div>
</div>
</div>
<p>Next, we install the Pyramid web framework into our new virtualenv.</p>
<div class="build container">
<p>We can do this with the <tt class="docutils literal"><span class="pre">pip</span></tt> in our active <tt class="docutils literal"><span class="pre">ljenv</span></tt>:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="o">(</span>ljenv<span class="o">)</span><span class="nv">$ </span>pip install pyramid
Collecting pyramid
  Downloading pyramid-1.5.2-py2.py3-none-any.whl <span class="o">(</span>545kB<span class="o">)</span>
    100% |################################| 548kB 172kB/s
...
Successfully installed PasteDeploy-1.5.2 WebOb-1.4
pyramid-1.5.2 repoze.lru-0.6 translationstring-1.3
venusian-1.0 zope.deprecation-4.1.1 zope.interface-4.1.2
</pre></div>
</div>
<p>Once that is complete, we are ready to create a <em>scaffold</em> for our project.</p>
</div>
</div>
<div class="section" id="working-with-pyramid">
<h3>Working with Pyramid<a class="headerlink" href="#working-with-pyramid" title="Permalink to this headline">¶</a></h3>
<p>Many web frameworks require at least a bit of <em>boilerplate</em> code to get
started.</p>
<div class="build container">
<p>Pyramid does not.</p>
<p>However, our application will require a database and handling that does
require some.</p>
<p>Pyramid provides a system for creating boilerplate called <tt class="docutils literal"><span class="pre">pcreate</span></tt>.</p>
<p>You use it to generate the skeleton for a project based on some pattern:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="o">(</span>ljenv<span class="o">)</span><span class="nv">$ </span>pcreate -s alchemy learning_journal
Creating directory /Users/cewing/projects/learning-journal/learning_journal
...
Welcome to Pyramid.  Sorry <span class="k">for </span>the convenience.
<span class="o">===============================================================================</span>
</pre></div>
</div>
<p>Let&#8217;s take a quick look at what that did</p>
</div>
<div class="highlight-bash"><div class="highlight"><pre><span class="o">(</span>ljenv<span class="o">)</span><span class="nv">$ </span>tree learning_journal/
learning_journal/
...
├── development.ini
├── learning_journal
│   ├── __init__.py
│   ├── models.py
│   ├── scripts
│   │   ├── __init__.py
│   │   └── initializedb.py
│   ├── static
...
│   ├── templates
│   │   └── mytemplate.pt
│   ├── tests.py
│   └── views.py
├── production.ini
└── setup.py
</pre></div>
</div>
<p>You&#8217;ve now created something worth saving.</p>
<div class="build container">
<p>Start by initializing a new git repository in the <cite>learning_journal</cite> folder
you just created:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="o">(</span>ljenv<span class="o">)</span><span class="nv">$ </span><span class="nb">cd </span>learning_journal
<span class="o">(</span>ljenv<span class="o">)</span><span class="nv">$ </span>git init
Initialized empty Git repository in
 /Users/cewing/projects/learning-journal/learning_journal/.git/
</pre></div>
</div>
</div>
<p>Check <tt class="docutils literal"><span class="pre">git</span> <span class="pre">status</span></tt> to see where things stand:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="o">(</span>ljenv<span class="o">)</span><span class="nv">$ </span>git status
On branch master

Initial commit

Untracked files:
  <span class="o">(</span>use <span class="s2">&quot;git add &lt;file&gt;...&quot;</span> to include in what will be committed<span class="o">)</span>

    CHANGES.txt
    MANIFEST.in
    README.txt
    development.ini
    learning_journal/
    production.ini
    setup.py
</pre></div>
</div>
<p>Add your work to this new repository:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="o">(</span>ljenv<span class="o">)</span><span class="nv">$ </span>git add .
<span class="o">(</span>ljenv<span class="o">)</span><span class="nv">$ </span>git status
...
Changes to be committed:
  <span class="o">(</span>use <span class="s2">&quot;git rm --cached &lt;file&gt;...&quot;</span> to unstage<span class="o">)</span>

    new file:   CHANGES.txt
    new file:   MANIFEST.in
    ...
    new file:   production.ini
    new file:   setup.py
</pre></div>
</div>
<p>Python creates <tt class="docutils literal"><span class="pre">.pyc</span></tt> files when it executes your code.</p>
<div class="build container">
<p>There are many other files you don&#8217;t want or need in your repository</p>
<p>You can ignore this in <tt class="docutils literal"><span class="pre">git</span></tt> with the <tt class="docutils literal"><span class="pre">.gitignore</span></tt> file.</p>
<p>Create one now, in this same directory, and add the following basic lines:</p>
<div class="highlight-python"><div class="highlight"><pre>*.pyc
.DS_Store
</pre></div>
</div>
<p>Finally, add this new file to your repository, too.</p>
</div>
<p>To preserve all these changes, you&#8217;ll need to commit what you&#8217;ve done:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="o">(</span>ljenv<span class="o">)</span><span class="nv">$ </span>git commit -m <span class="s2">&quot;initial commit of the Pyramid learning journal&quot;</span>
</pre></div>
</div>
<div class="build container">
<p>This will make a first commit here in this local repository.</p>
<p>For homework, you&#8217;ll put this into GitHub, but this is enough for now.</p>
<p>Let&#8217;s move on to learning about what we&#8217;ve built so far.</p>
</div>
<p>When you ran the <tt class="docutils literal"><span class="pre">pcreate</span></tt> command, a new folder was created:
<tt class="docutils literal"><span class="pre">learning_journal</span></tt>.</p>
<div class="build container">
<p>This folder contains your <em>project</em>.</p>
<p>At the top level, you have <em>configuration</em> (.ini files)</p>
<p>You also have a file called <tt class="docutils literal"><span class="pre">setup.py</span></tt></p>
<p>This file turns this collection of Python code and configuration into an
<em>installable Python distribution</em></p>
<p>Let&#8217;s take a moment to look over the code in that file</p>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">setuptools</span> <span class="kn">import</span> <span class="n">setup</span><span class="p">,</span> <span class="n">find_packages</span>
<span class="o">...</span>
<span class="n">requires</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s">&#39;pyramid&#39;</span><span class="p">,</span>
    <span class="o">...</span> <span class="c"># packages on which this software depends (dependencies)</span>
    <span class="p">]</span>
<span class="n">setup</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;learning_journal&#39;</span><span class="p">,</span>
      <span class="n">version</span><span class="o">=</span><span class="s">&#39;0.0&#39;</span><span class="p">,</span>
      <span class="o">...</span> <span class="c"># package metadata (used by PyPI)</span>
      <span class="n">install_requires</span><span class="o">=</span><span class="n">requires</span><span class="p">,</span>
      <span class="c"># Entry points are ways that we can run our code once installed</span>
      <span class="n">entry_points</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">      [paste.app_factory]</span>
<span class="s">      main = learning_journal:main</span>
<span class="s">      [console_scripts]</span>
<span class="s">      initialize_learning_journal_db = learning_journal.scripts.initializedb:main</span>
<span class="s">      &quot;&quot;&quot;</span><span class="p">,</span>
      <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="pyramid-is-python">
<h3>Pyramid is Python<a class="headerlink" href="#pyramid-is-python" title="Permalink to this headline">¶</a></h3>
<p>In the <tt class="docutils literal"><span class="pre">__init__.py</span></tt> file of your app <em>package</em>, you&#8217;ll find a <tt class="docutils literal"><span class="pre">main</span></tt>
function:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">global_config</span><span class="p">,</span> <span class="o">**</span><span class="n">settings</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; This function returns a Pyramid WSGI application.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">engine</span> <span class="o">=</span> <span class="n">engine_from_config</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="s">&#39;sqlalchemy.&#39;</span><span class="p">)</span>
    <span class="n">DBSession</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">bind</span><span class="o">=</span><span class="n">engine</span><span class="p">)</span>
    <span class="n">Base</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">bind</span> <span class="o">=</span> <span class="n">engine</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">Configurator</span><span class="p">(</span><span class="n">settings</span><span class="o">=</span><span class="n">settings</span><span class="p">)</span>
    <span class="n">config</span><span class="o">.</span><span class="n">include</span><span class="p">(</span><span class="s">&#39;pyramid_chameleon&#39;</span><span class="p">)</span>
    <span class="n">config</span><span class="o">.</span><span class="n">add_static_view</span><span class="p">(</span><span class="s">&#39;static&#39;</span><span class="p">,</span> <span class="s">&#39;static&#39;</span><span class="p">,</span> <span class="n">cache_max_age</span><span class="o">=</span><span class="mi">3600</span><span class="p">)</span>
    <span class="n">config</span><span class="o">.</span><span class="n">add_route</span><span class="p">(</span><span class="s">&#39;home&#39;</span><span class="p">,</span> <span class="s">&#39;/&#39;</span><span class="p">)</span>
    <span class="n">config</span><span class="o">.</span><span class="n">scan</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">config</span><span class="o">.</span><span class="n">make_wsgi_app</span><span class="p">()</span>
</pre></div>
</div>
<p>Let&#8217;s take a closer look at this, line by line.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">global_config</span><span class="p">,</span> <span class="o">**</span><span class="n">settings</span><span class="p">):</span>
</pre></div>
</div>
<p>Configuration is passed in to an application after being read from the
<tt class="docutils literal"><span class="pre">.ini</span></tt> file we saw above.</p>
<div class="build container">
<p>These files contain sections (<tt class="docutils literal"><span class="pre">[app:main]</span></tt>) containing <tt class="docutils literal"><span class="pre">name</span> <span class="pre">=</span> <span class="pre">value</span></tt>
pairs of <em>configuration data</em></p>
<p>This data is parsed with the Python
<a class="reference external" href="http://docs.python.org/2/library/configparser.html">ConfigParser</a> module.</p>
<p>The result is a dict of values:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span><span class="s">&#39;app:main&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;pyramid.reload_templates&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span> <span class="o">...</span><span class="p">},</span> <span class="o">...</span><span class="p">}</span>
</pre></div>
</div>
<p>The default section of the file is passed in as <tt class="docutils literal"><span class="pre">global_config</span></tt>, the
section for <em>this app</em> as <tt class="docutils literal"><span class="pre">settings</span></tt>.</p>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">engine_from_config</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">DBSession</span><span class="p">,</span> <span class="n">Base</span>
<span class="o">...</span>
<span class="n">engine</span> <span class="o">=</span> <span class="n">engine_from_config</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="s">&#39;sqlalchemy.&#39;</span><span class="p">)</span>
<span class="n">DBSession</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">bind</span><span class="o">=</span><span class="n">engine</span><span class="p">)</span>
<span class="n">Base</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">bind</span> <span class="o">=</span> <span class="n">engine</span>
</pre></div>
</div>
<p>We will use a package called <tt class="docutils literal"><span class="pre">SQLAlchemy</span></tt> to interact with our database.</p>
<div class="build container">
<p>Our connection is set up using settings read from the <tt class="docutils literal"><span class="pre">.ini</span></tt> file.</p>
<p>Can you find the settings for the database?</p>
<p>The <tt class="docutils literal"><span class="pre">DBSession</span></tt> ensures that each <em>database transaction</em> is tied to HTTP
requests.</p>
<p>The <tt class="docutils literal"><span class="pre">Base</span></tt> provides a parent class that will hook our <em>models</em> to the
database.</p>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">config</span> <span class="o">=</span> <span class="n">Configurator</span><span class="p">(</span><span class="n">settings</span><span class="o">=</span><span class="n">settings</span><span class="p">)</span>
<span class="n">config</span><span class="o">.</span><span class="n">include</span><span class="p">(</span><span class="s">&#39;pyramid_chameleon&#39;</span><span class="p">)</span>
<span class="n">config</span><span class="o">.</span><span class="n">add_static_view</span><span class="p">(</span><span class="s">&#39;static&#39;</span><span class="p">,</span> <span class="s">&#39;static&#39;</span><span class="p">,</span> <span class="n">cache_max_age</span><span class="o">=</span><span class="mi">3600</span><span class="p">)</span>
<span class="n">config</span><span class="o">.</span><span class="n">add_route</span><span class="p">(</span><span class="s">&#39;home&#39;</span><span class="p">,</span> <span class="s">&#39;/&#39;</span><span class="p">)</span>
<span class="n">config</span><span class="o">.</span><span class="n">scan</span><span class="p">()</span>
</pre></div>
</div>
<p>Pyramid controlls application-level configuration using a <tt class="docutils literal"><span class="pre">Configurator</span></tt> class.</p>
<div class="build container">
<p>It uses app-specific settings passed in from the <tt class="docutils literal"><span class="pre">.ini</span></tt> file</p>
<p>We can also <tt class="docutils literal"><span class="pre">include</span></tt> configuration from other add-on packages</p>
<p>Additionally, we can configure <em>routes</em> and <em>views</em> needed to connect our
application to the outside world here (more on this next week).</p>
<p>Finally, the <tt class="docutils literal"><span class="pre">Configurator</span></tt> instance performs a <tt class="docutils literal"><span class="pre">scan</span></tt> to ensure there
are no problems with what we&#8217;ve created.</p>
</div>
<p>We will return to the configuration of our application repeatedly over the next
sessions.</p>
<div class="build container">
<p>Pyramid configuration is powerful and flexible.</p>
<p>We&#8217;ll use a few of its features</p>
<p>But there&#8217;s a lot more you could (and should) learn.</p>
<p>Read about it in the <a class="reference external" href="http://docs.pylonsproject.org/projects/pyramid/en/latest/api/config.html">configuration chapter</a> of the Pyramid documentation.</p>
</div>
<p>Let&#8217;s take a moment to rest up and absorb what we&#8217;ve learned.</p>
<p>When we return, we&#8217;ll see how we can create <em>models</em> that will embody the data
for our Learning Journal application.</p>
<p class="centered"><strong>Pyramid Models</strong></p>
</div>
</div>
<div class="section" id="models-in-pyramid">
<h2>Models in Pyramid<a class="headerlink" href="#models-in-pyramid" title="Permalink to this headline">¶</a></h2>
<div class="left container">
<p>The central component of MVC, the model, captures the behavior of the
application in terms of its problem domain, independent of the user
interface. The model directly manages the data, logic and rules of the
application</p>
<p>&#8211; from the Wikipedia article on <a class="reference external" href="http://en.wikipedia.org/wiki/Model–view–controller">Model-view-controller</a></p>
</div>
<div class="section" id="models-and-orms">
<h3>Models and ORMs<a class="headerlink" href="#models-and-orms" title="Permalink to this headline">¶</a></h3>
<p>In an MVC application, we define the <em>problem domain</em> by creating one or more
<em>Models</em>.</p>
<div class="build container">
<p>These capture relevant details about the information we want to preserve
and how we want to interact with it.</p>
<p>In Python-based MVC applications, these <em>Models</em> are implemented as Python
classes.</p>
<p>The individual bits of data we want to know about are <em>attributes</em> of our
classes.</p>
<p>The actions we want to take using that data are <em>methods</em> of our classes.</p>
<p>Together, we can refer to this as the <em>API</em> of our system.</p>
</div>
<p>It&#8217;s all well and good to have a set of Python classes that represent your
system.</p>
<div class="build container">
<p>But what happens when you want to <em>save</em> information.</p>
<p>What happens to a instance of a Python class when you quit the interprer?</p>
<p>When your script stops running?</p>
<p>The code in a website runs when an HTTP request comes in from a client.</p>
<p>It stops running when an HTTP response goes back out to the client.</p>
<p>So what happens to the data in your system in-between these moments?</p>
<p>The data must be <em>persisted</em></p>
</div>
<p>In the last class from part one of this series, you explored a number of
alternatives for persistence</p>
<ul class="build simple">
<li>Python Literals</li>
<li>Pickle/Shelf</li>
<li>Interchange Files (CSV, XML, INI)</li>
<li>Object Stores (ZODB, Durus)</li>
<li>NoSQL Databases (MongoDB, CouchDB)</li>
<li>SQL Databases (sqlite, MySQL, PostgreSQL, Oracle, SQLServer)</li>
</ul>
<div class="build container">
<p>Any of these might be useful for certain types of applications.</p>
<p>On the web, you tend to see two used the most:</p>
<ul class="build simple">
<li>NoSQL</li>
<li>SQL</li>
</ul>
</div>
<p>How do you choose one over the other?</p>
<div class="build container">
<p>In general, the telling factor is going to be how you intend to use your
data.</p>
<p>In systems where the dominant feature is viewing/interacting with
individual objects, a NoSQL storage solution might be the best way to go.</p>
<p>In systems with objects that are related to eachother, SQL-based Relational
Databases are a better choice.</p>
<p>Our system is more like this latter type (trust me on that one for now).</p>
<p>We&#8217;ll be using SQL (sqlite to start with).</p>
</div>
<p>So we have a system where our data is captured in Python <em>objects</em></p>
<div class="build container">
<p>And a storage system where our data must be rendered as database <em>tables</em></p>
<p>Python provides a specification for interacting directly with databases:
<a class="reference external" href="https://www.python.org/dev/peps/pep-0249/">dbapi2</a></p>
<p>And there are multiple Python packages that implement this specification
for various databases:</p>
<ul class="build simple">
<li>sqlite3</li>
<li>python-mysql</li>
<li>psycopg2</li>
<li>...</li>
</ul>
<p>With these, you can write SQL to save your Python objects into your
database.</p>
</div>
<p>But that&#8217;s a pain.</p>
<div class="build container">
<p>SQL, while not impossible, is yet another language to learn.</p>
<p>And there is a viable alternative in using an <em>Object Relational Manager</em>
(ORM)</p>
<p>An ORM provides a layer of <em>abstraction</em> between you and SQL</p>
<p>You instantiate Python objects and set attributes on them</p>
<p>The ORM handles converting data from these objects into SQL statements (and
back)</p>
</div>
</div>
<div class="section" id="sqlalchemy">
<h3>SQLAlchemy<a class="headerlink" href="#sqlalchemy" title="Permalink to this headline">¶</a></h3>
<p>In our project we will be using the <a class="reference external" href="http://docs.sqlalchemy.org/en/rel_0_9/">SQLAlchemy</a> ORM.</p>
<div class="build container">
<p>You can find SQLAlchemy among the packages in <tt class="docutils literal"><span class="pre">requires</span></tt> in <tt class="docutils literal"><span class="pre">setup.py</span></tt>
in our new <tt class="docutils literal"><span class="pre">learning_journal</span></tt> package.</p>
<p>However, we don&#8217;t yet have that code installed.</p>
<p>To do so, we will need to &#8220;install&#8221; our own package</p>
<p>Make sure your <tt class="docutils literal"><span class="pre">ljenv</span></tt> virtualenv is active and then type the following:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="o">(</span>ljenv<span class="o">)</span><span class="nv">$ </span>python setup.py develop
running develop
running egg_info
creating learning_journal.egg-info
...
Finished processing dependencies <span class="k">for </span>learning-journal<span class="o">==</span>0.0
</pre></div>
</div>
</div>
<p>Once that is complete, all the <em>dependencies</em> listed in our <tt class="docutils literal"><span class="pre">setup.py</span></tt> will
be installed.</p>
<div class="build container">
<p>You can also install the package using <tt class="docutils literal"><span class="pre">python</span> <span class="pre">setup.py</span> <span class="pre">install</span></tt></p>
<p>But using <tt class="docutils literal"><span class="pre">develop</span></tt> allows us to continue developing our package without
needing to re-install it every time we change something.</p>
<p>It is very similar to using the <tt class="docutils literal"><span class="pre">-e</span></tt> option to <tt class="docutils literal"><span class="pre">pip</span></tt></p>
<p>Now, we&#8217;ll only need to re-run this command if we change <tt class="docutils literal"><span class="pre">setup.py</span></tt>
itself.</p>
</div>
<p>We also need to adjust our <tt class="docutils literal"><span class="pre">.gitignore</span></tt> file:</p>
<div class="build highlight-bash"><div class="highlight"><pre><span class="o">(</span>ljenv<span class="o">)</span><span class="nv">$ </span>git status
...
Untracked files:
  <span class="o">(</span>use <span class="s2">&quot;git add &lt;file&gt;...&quot;</span> to include in what will be committed<span class="o">)</span>

    learning_journal.egg-info/
</pre></div>
</div>
<div class="build container">
<p>The <tt class="docutils literal"><span class="pre">egg-info</span></tt> directory that was just created is an artifact of
installing a Python egg.</p>
<p>It should never be committed to a repository.</p>
<p>Let&#8217;s add <tt class="docutils literal"><span class="pre">*.egg-info</span></tt> to our <tt class="docutils literal"><span class="pre">.gitignore</span></tt> file and then commit that
change</p>
<p>Remember how?</p>
</div>
<p>Our project skeleton contains up a first, basic model created for us:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># in models.py</span>
<span class="n">Base</span> <span class="o">=</span> <span class="n">declarative_base</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">MyModel</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s">&#39;models&#39;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Text</span><span class="p">)</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">)</span>
<span class="n">Index</span><span class="p">(</span><span class="s">&#39;my_index&#39;</span><span class="p">,</span> <span class="n">MyModel</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">mysql_length</span><span class="o">=</span><span class="mi">255</span><span class="p">)</span>
</pre></div>
</div>
<div class="build container">
<p>Our class inherits from <tt class="docutils literal"><span class="pre">Base</span></tt></p>
<p>We ran into <tt class="docutils literal"><span class="pre">Base</span></tt> earlier when discussing configuration.</p>
<p>We were binding it to the database we wanted to use (the <tt class="docutils literal"><span class="pre">engine</span></tt>)</p>
</div>
<p>Any class we create that inherits from this <tt class="docutils literal"><span class="pre">Base</span></tt> becomes a <em>model</em></p>
<div class="build container">
<p>It will be connected through the ORM to a table in our database.</p>
<p>The name of the table is determined by the <tt class="docutils literal"><span class="pre">__tablename__</span></tt> special
attribute.</p>
<p>Other aspects of table configuration can also be controlled through special
attributes</p>
<p>Instances of the class, once saved, will become rows in the table.</p>
<p>Attributes of the model that are instances of <tt class="docutils literal"><span class="pre">Column</span></tt> will become
columns in the table.</p>
<p>You can learn much more in the <a class="reference external" href="http://docs.sqlalchemy.org/en/rel_0_9/orm/extensions/declarative/">Declarative</a> chapter of the SQLAlchemy docs</p>
</div>
<p>Each attribute of your model that will be persisted must be an instance of
<a class="reference external" href="http://docs.sqlalchemy.org/en/rel_0_9/core/metadata.html#sqlalchemy.schema.Column">Column</a>.</p>
<div class="build container">
<p>Each instance requires <em>at least</em> a specific <a class="reference external" href="http://docs.sqlalchemy.org/en/rel_0_9/core/types.html">data type</a> (such as
Integer).</p>
<p>Additionally, you can control other aspects of the column such as it being
a primary key.</p>
<p>In the <em>declarative</em> style we are using, the name of the column in the
database will default to the attribute name you assigned.</p>
<p>If you wish, you may provide a name specifically.  It must be the first
argument and must be a string.</p>
</div>
</div>
<div class="section" id="creating-the-database">
<h3>Creating The Database<a class="headerlink" href="#creating-the-database" title="Permalink to this headline">¶</a></h3>
<p>We have a <em>model</em> which allows us to persist Python objects to an SQL database.</p>
<div class="build container">
<p>But we&#8217;re still missing one ingredient here.</p>
<p>We need to create our database, or there will be nowhere for our data to
go.</p>
<p>Luckily, our <tt class="docutils literal"><span class="pre">pcreate</span></tt> scaffold also gave us a convenient way to handle
this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># in setup.py</span>
<span class="n">entry_points</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">[paste.app_factory]</span>
<span class="s">main = learning_journal:main</span>
<span class="s">[console_scripts]</span>
<span class="s">initialize_learning_journal_db = learning_journal.scripts.initializedb:main</span>
<span class="s">&quot;&quot;&quot;</span><span class="p">,</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">console_script</span></tt> set up as an entry point will help us.</p>
</div>
<p>Let&#8217;s look at that code for a moment.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># in scripts/intitalizedb.py</span>
<span class="kn">from</span> <span class="nn">..models</span> <span class="kn">import</span> <span class="n">DBSession</span><span class="p">,</span> <span class="n">MyModel</span><span class="p">,</span> <span class="n">Base</span>
<span class="c"># ...</span>
<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">argv</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">argv</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">usage</span><span class="p">(</span><span class="n">argv</span><span class="p">)</span>
    <span class="n">config_uri</span> <span class="o">=</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">options</span> <span class="o">=</span> <span class="n">parse_vars</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">:])</span>
    <span class="n">setup_logging</span><span class="p">(</span><span class="n">config_uri</span><span class="p">)</span>
    <span class="n">settings</span> <span class="o">=</span> <span class="n">get_appsettings</span><span class="p">(</span><span class="n">config_uri</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">)</span>
    <span class="n">engine</span> <span class="o">=</span> <span class="n">engine_from_config</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="s">&#39;sqlalchemy.&#39;</span><span class="p">)</span>
    <span class="n">DBSession</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">bind</span><span class="o">=</span><span class="n">engine</span><span class="p">)</span>
    <span class="n">Base</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">create_all</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">transaction</span><span class="o">.</span><span class="n">manager</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">MyModel</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;one&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">DBSession</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
</pre></div>
</div>
<p>By connecting this function as a <tt class="docutils literal"><span class="pre">console</span> <span class="pre">script</span></tt>, our Python package makes
this command available to us.</p>
<div class="build container">
<p>When we exectute <tt class="docutils literal"><span class="pre">initialize_learning_journal_db</span></tt> at the command line, we
will be running this function.</p>
<p>Let&#8217;s try it out.</p>
<p>We&#8217;ll need to provide a configuration file name, let&#8217;s use
<tt class="docutils literal"><span class="pre">development.ini</span></tt>:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="o">(</span>ljenv<span class="o">)</span><span class="nv">$ </span>initialize_learning_journal_db development.ini
2015-01-05 18:59:55,426 INFO  <span class="o">[</span>sqlalchemy.engine.base.Engine<span class="o">][</span>MainThread<span class="o">]</span> SELECT CAST<span class="o">(</span><span class="s1">&#39;test plain returns&#39;</span> AS VARCHAR<span class="o">(</span>60<span class="o">))</span> AS anon_1
...
2015-01-05 18:59:55,434 INFO  <span class="o">[</span>sqlalchemy.engine.base.Engine<span class="o">][</span>MainThread<span class="o">]</span> COMMIT
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">[loggers]</span></tt> configuration in our <tt class="docutils literal"><span class="pre">.ini</span></tt> file sends a stream of
INFO-level logging to sys.stdout as the console script runs.</p>
</div>
<p>So what was the outcome of running that script?</p>
<div class="build container">
<div class="highlight-bash"><div class="highlight"><pre><span class="o">(</span>ljenv<span class="o">)</span><span class="nv">$ </span>ls
...
learning_journal.sqlite
...
</pre></div>
</div>
<p>We&#8217;ve now created an sqlite database.</p>
<p>You&#8217;ll need to add <tt class="docutils literal"><span class="pre">*.sqlite</span></tt> to <tt class="docutils literal"><span class="pre">.gitignore</span></tt> so you don&#8217;t add that
file to your repository.</p>
<p>Once you&#8217;ve done so, commit the change to your repository</p>
</div>
</div>
<div class="section" id="interacting-with-sqla-models">
<h3>Interacting with SQLA Models<a class="headerlink" href="#interacting-with-sqla-models" title="Permalink to this headline">¶</a></h3>
<p>It&#8217;s pretty easy to play with your models from in an interpreter.</p>
<div class="build container">
<p>Let&#8217;s try that out and see what we have.  Start up an interpreter:</p>
<div class="highlight-pycon"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">config</span> <span class="o">=</span> <span class="s">&#39;development.ini&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyramid.paster</span> <span class="kn">import</span> <span class="n">get_appsettings</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">settings</span> <span class="o">=</span> <span class="n">get_appsettings</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">engine_from_config</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">engine</span> <span class="o">=</span> <span class="n">engine_from_config</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="s">&#39;sqlalchemy.&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">sessionmaker</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Session</span> <span class="o">=</span> <span class="n">sessionmaker</span><span class="p">(</span><span class="n">bind</span><span class="o">=</span><span class="n">engine</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">session</span> <span class="o">=</span> <span class="n">Session</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">learning_journal.models</span> <span class="nn">MyModel</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">MyModel</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="go">[&lt;learning_journal.models.MyModel object at 0x10b075ed0&gt;]</span>
</pre></div>
</div>
<p>We are basically stealing the important bits from <tt class="docutils literal"><span class="pre">initializedb.py</span></tt></p>
</div>
<p>Any interaction with the database requires a <tt class="docutils literal"><span class="pre">session</span></tt>.</p>
<div class="build container">
<p>This object represents the connection to the database.</p>
<p>All database queries are phrased as methods of the session.</p>
<div class="container">
<div class="highlight-pycon"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">query</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">MyModel</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">type</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
<span class="go">&lt;class &#39;sqlalchemy.orm.query.Query&#39;&gt;</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">query</span></tt> method of the session object returns a <tt class="docutils literal"><span class="pre">Query</span></tt> object</p>
</div>
<p>Arguments to the <tt class="docutils literal"><span class="pre">query</span></tt> method can be a <em>model</em> class or <em>columns</em> from
a model class.</p>
</div>
<p>You can iterate over a query object.  The result depends on the args you
passed.</p>
<div class="build container">
<div class="highlight-pycon"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">q1</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">MyModel</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">q1</span><span class="p">:</span>
<span class="gp">... </span>  <span class="k">print</span> <span class="n">row</span>
<span class="gp">... </span>  <span class="nb">type</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
<span class="gp">...</span>
<span class="go">&lt;learning_journal.models.MyModel object at 0x1103d9f10&gt;</span>
<span class="go">&lt;class &#39;learning_journal.models.MyModel&#39;&gt;</span>
</pre></div>
</div>
<div class="highlight-pycon"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">q2</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">MyModel</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">MyModel</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">MyModel</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">q2</span><span class="p">:</span>
<span class="gp">... </span>  <span class="k">print</span> <span class="n">name</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
<span class="gp">... </span>  <span class="k">print</span> <span class="nb">id</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
<span class="gp">... </span>  <span class="k">print</span> <span class="n">val</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
<span class="gp">...</span>
<span class="go">one &lt;type &#39;unicode&#39;&gt;</span>
<span class="go">1 &lt;type &#39;int&#39;&gt;</span>
<span class="go">1 &lt;type &#39;int&#39;&gt;</span>
</pre></div>
</div>
</div>
<p>You can view the SQL that your query will use:</p>
<div class="build container">
<div class="highlight-pycon"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">str</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span>
<span class="go">&#39;SELECT models.id AS models_id, models.name AS models_name, models.value AS models_value \nFROM models&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">str</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span>
<span class="go">&#39;SELECT models.name AS models_name, models.id AS models_id, models.value AS models_value \nFROM models&#39;</span>
</pre></div>
</div>
<p>You can use this to check that the query the ORM is constructing looks like
you expect.</p>
<p>It can be helpful in debugging.</p>
</div>
<p>The methods of the <tt class="docutils literal"><span class="pre">Query</span></tt> object fall into two rough categories</p>
<div class="build container">
<ol class="build arabic simple">
<li>Methods that return a new <tt class="docutils literal"><span class="pre">Query</span></tt> object</li>
<li>Methods that return <em>scalar</em> values or <em>model</em> instances</li>
</ol>
<p>Let&#8217;s start by looking quickly at a few methods from the second category</p>
</div>
<p>A good example of this category of methods is <tt class="docutils literal"><span class="pre">get</span></tt>, which returns one
instance only.</p>
<div class="build container">
<p>It takes a primary key as an argument:</p>
<div class="highlight-pycon"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">MyModel</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="go">&lt;learning_journal.models.MyModel object at 0x1103d9f10&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">MyModel</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
</pre></div>
</div>
<p>If no item with that primary key is present, then the method returns
<tt class="docutils literal"><span class="pre">None</span></tt></p>
</div>
<p>Another example is one we&#8217;ve already seen.</p>
<div class="build container">
<p><tt class="docutils literal"><span class="pre">query.all()</span></tt> returns a list of all rows returned by the database:</p>
<div class="highlight-pycon"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">q1</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="go">[&lt;learning_journal.models.MyModel object at 0x1103d9f10&gt;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">type</span><span class="p">(</span><span class="n">q1</span><span class="o">.</span><span class="n">all</span><span class="p">())</span>
<span class="go">&lt;type &#39;list&#39;&gt;</span>
</pre></div>
</div>
<p><tt class="docutils literal"><span class="pre">query.count()</span></tt> returns the number of rows that would have been returned
by the query:</p>
<div class="highlight-pycon"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">q1</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="go">1</span>
</pre></div>
</div>
</div>
<p>Before getting into the other category, let&#8217;s learn how to create new objects.</p>
<div class="build container">
<div class="container">
<p>We can create new instances of our <em>model</em> just like normal Python
objects:</p>
<div class="highlight-pycon"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">new_model</span> <span class="o">=</span> <span class="n">MyModel</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;fred&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">new_model</span>
<span class="go">&lt;learning_journal.models.MyModel object at 0x1103e38d0&gt;</span>
</pre></div>
</div>
</div>
<div class="container">
<p>In this state, the instance is <em>ephemeral</em>, our <tt class="docutils literal"><span class="pre">session</span></tt> knows
nothing about it:</p>
<div class="highlight-pycon"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">session</span><span class="o">.</span><span class="n">new</span>
<span class="go">IdentitySet([])</span>
</pre></div>
</div>
</div>
</div>
<p>For the database to know about our new object, we must <tt class="docutils literal"><span class="pre">add</span></tt> it to the
session:</p>
<div class="build container">
<div class="highlight-pycon"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">new_model</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">session</span><span class="o">.</span><span class="n">new</span>
<span class="go">IdentitySet([&lt;learning_journal.models.MyModel object at 0x1103e38d0&gt;])</span>
</pre></div>
</div>
<p>We can even bulk-add new objects:</p>
<div class="highlight-pycon"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">new</span> <span class="o">=</span> <span class="p">[]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">[(</span><span class="s">&#39;bob&#39;</span><span class="p">,</span> <span class="mi">34</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;tom&#39;</span><span class="p">,</span> <span class="mi">13</span><span class="p">)]:</span>
<span class="gp">... </span>  <span class="n">new</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">MyModel</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">val</span><span class="p">))</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">session</span><span class="o">.</span><span class="n">add_all</span><span class="p">(</span><span class="n">new</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">session</span><span class="o">.</span><span class="n">new</span>
<span class="go">IdentitySet([&lt;learning_journal.models.MyModel object at 0x1103e3f50&gt;,</span>
<span class="go">             &lt;learning_journal.models.MyModel object at 0x1103e38d0&gt;,</span>
<span class="go">             &lt;learning_journal.models.MyModel object at 0x1103e3fd0&gt;])</span>
</pre></div>
</div>
</div>
<p>Up until now, the changes you&#8217;ve made are not permanent.</p>
<div class="build container">
<p>In order for these new objects to be saved to the database, the session
must be <tt class="docutils literal"><span class="pre">committed</span></tt>:</p>
<div class="highlight-pycon"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">other_session</span> <span class="o">=</span> <span class="n">Session</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">other_session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">MyModel</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">other_session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">MyModel</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
</pre></div>
</div>
<p>When you are using a <tt class="docutils literal"><span class="pre">scoped_session</span></tt> in Pyramid, this action is
automatically handled for you.</p>
<p>The session that is bound to a particular HTTP request is committed when a
response is sent back.</p>
</div>
<p>You can edit objects that are already part of a session, or that are fetched by
a query.</p>
<div class="build container">
<p>Simply change the values of a persisted attribute, the session will know
it&#8217;s been updated:</p>
<div class="highlight-pycon"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">new_model</span>
<span class="go">&lt;learning_journal.models.MyModel object at 0x1103e38d0&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">new_model</span><span class="o">.</span><span class="n">name</span>
<span class="go">u&#39;fred&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">new_model</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;larry&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">session</span><span class="o">.</span><span class="n">dirty</span>
<span class="go">IdentitySet([&lt;learning_journal.models.MyModel object at 0x1103e38d0&gt;])</span>
</pre></div>
</div>
<p>Commit the session to persist the changes:</p>
<div class="highlight-pycon"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>Returning to queries, the second category is typified by the <tt class="docutils literal"><span class="pre">filter</span></tt> method</p>
<div class="build container">
<p>This method allows you to reduce the number of results, based on criteria:</p>
<div class="highlight-pycon"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">MyModel</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">MyModel</span><span class="o">.</span><span class="n">value</span> <span class="o">&lt;</span> <span class="mi">20</span><span class="p">):</span>
<span class="gp">... </span>  <span class="k">print</span> <span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">value</span>
<span class="gp">...</span>
<span class="go">larry 1</span>
<span class="go">fred 3</span>
<span class="go">tom 13</span>
</pre></div>
</div>
</div>
<p>Another typical method in this category is <tt class="docutils literal"><span class="pre">order_by</span></tt>:</p>
<div class="build container">
<div class="highlight-pycon"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">MyModel</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">MyModel</span><span class="o">.</span><span class="n">value</span><span class="p">):</span>
<span class="gp">... </span>  <span class="k">print</span> <span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">value</span>
<span class="gp">...</span>
<span class="go">larry 1</span>
<span class="go">fred 3</span>
<span class="go">tom 13</span>
<span class="go">bob 34</span>
</pre></div>
</div>
<div class="highlight-pycon"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">MyModel</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">MyModel</span><span class="o">.</span><span class="n">name</span><span class="p">):</span>
<span class="gp">... </span>  <span class="k">print</span> <span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">value</span>
<span class="gp">...</span>
<span class="go">bob 34</span>
<span class="go">fred 3</span>
<span class="go">larry 1</span>
<span class="go">tom 13</span>
</pre></div>
</div>
</div>
<p>Since methods in this category return <tt class="docutils literal"><span class="pre">Query</span></tt> objects, they can be safely
<em>chained</em> to build more complex queries:</p>
<div class="build container">
<div class="highlight-pycon"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">q1</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">MyModel</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">MyModel</span><span class="o">.</span><span class="n">value</span> <span class="o">&lt;</span> <span class="mi">20</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">q1</span> <span class="o">=</span> <span class="n">q1</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">MyModel</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">q1</span><span class="p">:</span>
<span class="gp">... </span>  <span class="k">print</span> <span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">value</span>
<span class="gp">...</span>
<span class="go">fred 3</span>
<span class="go">larry 1</span>
<span class="go">tom 13</span>
</pre></div>
</div>
<p>Note that you can do this inline as well
(<tt class="docutils literal"><span class="pre">s.query(Model).filter().order_by()</span></tt>)</p>
<p>Also note that when using chained queries like this, no query is actually
sent to the database until you require a result.</p>
</div>
</div>
</div>
<div class="section" id="homework">
<h2>Homework<a class="headerlink" href="#homework" title="Permalink to this headline">¶</a></h2>
<p>Okay, that&#8217;s enough for the moment.</p>
<div class="build container">
<p>You&#8217;ve learned quite a bit about how <em>models</em> work in SQLAlchemy</p>
<p>It&#8217;s time to put that knowledge to good use.</p>
<p>For the first part of your assignment this week you will begin to define
the data model for our learning journal application.</p>
<p>I&#8217;ll provide a specification, you define the model required to do the job.</p>
<p>I&#8217;ll also ask you to define a few methods to complete the first part of our
API.</p>
</div>
<p>Our model will be called an <tt class="docutils literal"><span class="pre">Entry</span></tt>. Here&#8217;s what you need to know:</p>
<ul class="simple">
<li>It should be stored in a database table called <tt class="docutils literal"><span class="pre">entries</span></tt></li>
<li>It should have a primary key field called <tt class="docutils literal"><span class="pre">id</span></tt></li>
<li>It should have a <tt class="docutils literal"><span class="pre">title</span></tt> field which accepts unicode text up to 255 characters in length</li>
<li>The <tt class="docutils literal"><span class="pre">title</span></tt> should be unique and it should be impossible to save an
<tt class="docutils literal"><span class="pre">entry</span></tt> without a <tt class="docutils literal"><span class="pre">title</span></tt>.</li>
<li>It should have a <tt class="docutils literal"><span class="pre">body</span></tt> field which accepts unicode text of any length
(including none)</li>
<li>It should have a <tt class="docutils literal"><span class="pre">created</span></tt> field which stores the date and time the object
was created.</li>
<li>It should have an <tt class="docutils literal"><span class="pre">edited</span></tt> field which stores the date and time the object
was last edited.</li>
<li>Both the <tt class="docutils literal"><span class="pre">created</span></tt> and <tt class="docutils literal"><span class="pre">edited</span></tt> field should default to <tt class="docutils literal"><span class="pre">now</span></tt> if not
provided when a new instance is constructed.</li>
<li>The <tt class="docutils literal"><span class="pre">entry</span></tt> class should support a classmethod <tt class="docutils literal"><span class="pre">all</span></tt> that returns all the
entries in the database, ordered so that the most recent entry is first.</li>
<li>The <tt class="docutils literal"><span class="pre">entry</span></tt> class should support a classmethod <tt class="docutils literal"><span class="pre">by_id</span></tt> that returns a
single entry, given an <tt class="docutils literal"><span class="pre">id</span></tt>.</li>
</ul>
<p>Use the documentation linked in this presentation to assist you.  SQLAlchemy
has fantastic documentation, but it can be a bit overwhelming.  Everything you
require for this assignment is on one or more of the pages linked above.</p>
<p>As you define this new model for our application, make frequent commits to your
github repository. Remember to write meaningful commit messages.</p>
<p>Don&#8217;t be afraid to start up a Python interpreter and play with your model. Try
things out. Learn how this all works by making mistakes.</p>
<p>Errors at the SQL level can sometimes leave your session unusable. To restore
it, use the <tt class="docutils literal"><span class="pre">session.rollback()</span></tt> method.  You&#8217;ll lose uncommitted changes,
but you&#8217;ll gain a session that can be used again.</p>
<p>I want to be able to review your code (and you want to be able to share it).</p>
<p>To submit this assignment, you&#8217;ll need to add this learning_journal repository
to GitHub.</p>
<p>On the GitHub website you can create a new repository.  Set it up to be
completely empty. Name it <tt class="docutils literal"><span class="pre">learning_journal</span></tt> and give it any description you
like.</p>
<p>When you&#8217;ve created an empty repository in GitHub, you should see a set of
directions for connecting it to a repository that you&#8217;ve already built. Follow
those instructions to connect your emtpy GitHub repository as the <tt class="docutils literal"><span class="pre">origin</span></tt>
remote to your <tt class="docutils literal"><span class="pre">learning_journal</span></tt> repository on your machine.</p>
<p>Finally, push your <tt class="docutils literal"><span class="pre">master</span></tt> branch to your new <tt class="docutils literal"><span class="pre">origin</span></tt> remote on GitHub.</p>
<p>When you are done, send me an email with the URL for your new repository.</p>
<p><strong>Our work next week will assume that you have completed this assignment</strong></p>
<p>Do not delay working on this until the last moment.</p>
<p>Do not skip this assignment.</p>
<p>Do ask questions frequently via email (use the <a class="reference external" href="https://groups.google.com/forum/#!forum/programming-in-python">class google group</a>).</p>
<p>See you next week!</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Session 01</a><ul>
<li><a class="reference internal" href="#introductions">Introductions</a><ul>
<li><a class="reference internal" href="#but-first">But First</a></li>
</ul>
</li>
<li><a class="reference internal" href="#working-with-virtualenv">Working with Virtualenv</a><ul>
<li><a class="reference internal" href="#why-virtualenv">Why Virtualenv?</a></li>
<li><a class="reference internal" href="#installing-virtualenv">Installing Virtualenv</a></li>
<li><a class="reference internal" href="#using-virtuelenv">Using Virtuelenv</a></li>
<li><a class="reference internal" href="#activation">Activation</a></li>
<li><a class="reference internal" href="#installing-packages">Installing Packages</a></li>
<li><a class="reference internal" href="#deactivation">Deactivation</a></li>
<li><a class="reference internal" href="#cleaning-up">Cleaning Up</a></li>
</ul>
</li>
<li><a class="reference internal" href="#mvc-applications">MVC Applications</a><ul>
<li><a class="reference internal" href="#separation-of-concerns">Separation of Concerns</a></li>
<li><a class="reference internal" href="#three-components">Three Components</a></li>
<li><a class="reference internal" href="#on-the-web">On the Web</a></li>
<li><a class="reference internal" href="#a-word-about-terminology">A Word About Terminology</a></li>
</ul>
</li>
<li><a class="reference internal" href="#our-first-application">Our First Application</a><ul>
<li><a class="reference internal" href="#id1">Pyramid</a></li>
<li><a class="reference internal" href="#starting-the-project">Starting the Project</a></li>
<li><a class="reference internal" href="#working-with-pyramid">Working with Pyramid</a></li>
<li><a class="reference internal" href="#pyramid-is-python">Pyramid is Python</a></li>
</ul>
</li>
<li><a class="reference internal" href="#models-in-pyramid">Models in Pyramid</a><ul>
<li><a class="reference internal" href="#models-and-orms">Models and ORMs</a></li>
<li><a class="reference internal" href="#sqlalchemy">SQLAlchemy</a></li>
<li><a class="reference internal" href="#creating-the-database">Creating The Database</a></li>
<li><a class="reference internal" href="#interacting-with-sqla-models">Interacting with SQLA Models</a></li>
</ul>
</li>
<li><a class="reference internal" href="#homework">Homework</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="index.html"
                        title="previous chapter">Course Presentations</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/presentations/session01.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
  <h3>Slides</h3>
  <ul class="this-page-menu">
    <li><a href="../.././slides/presentations/session01.html"
           rel="nofollow">View as slides</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="index.html" title="Course Presentations"
             >previous</a> |</li>
        <li><a href="../index.html">UWPCE Python 200</a> &raquo;</li>
          <li><a href="index.html" >Course Presentations</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012-2015, Cris Ewing.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>