<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.9.1: http://docutils.sourceforge.net/" />
<meta name="version" content="S5 1.1" />
<title>Internet Programming with Python</title>
<link rel="stylesheet" href="ui/uw_pce_theme/pretty.css" type="text/css" />
<!-- configuration parameters -->
<meta name="defaultView" content="slideshow" />
<meta name="controlVis" content="hidden" />
<!-- style sheet links -->
<script src="ui/uw_pce_theme/slides.js" type="text/javascript"></script>
<link rel="stylesheet" href="ui/uw_pce_theme/slides.css"
      type="text/css" media="projection" id="slideProj" />
<link rel="stylesheet" href="ui/uw_pce_theme/outline.css"
      type="text/css" media="screen" id="outlineStyle" />
<link rel="stylesheet" href="ui/uw_pce_theme/print.css"
      type="text/css" media="print" id="slidePrint" />
<link rel="stylesheet" href="ui/uw_pce_theme/opera.css"
      type="text/css" media="projection" id="operaFix" />
</head>
<body>
<div class="layout">
<div id="controls"></div>
<div id="currentSlide"></div>
<div id="header">

</div>
<div id="footer">
<h1>Internet Programming with Python</h1>
<h2><a class="reference external" href="http://github.com/cewing/training.python_web">View document source</a>.
</h2>
</div>
</div>
<div class="presentation">
<div class="slide" id="slide0">
<h1 class="title">Internet Programming with Python</h1>

<img alt="img/django-pony.png" class="align-left" src="img/django-pony.png" style="width: 50%;" />
<p>Week 6: Django - Part 1</p>
<p class="intro-blurb right">Wherein we become 'perfectionists with deadlines'</p>
<p class="image-credit">image: <a class="reference external" href="http://djangopony.com/">http://djangopony.com/</a></p>

</div>
<div class="slide" id="but-first">
<h1>But First</h1>
<p class="big-centered">Review from the Assignment</p>
</div>
<div class="slide" id="and-second">
<h1>And Second</h1>
<p class="big-centered">Questions from the Reading?</p>
</div>
<div class="slide" id="and-now">
<h1>And Now</h1>
<img alt="img/django_lead.png" class="align-center" src="img/django_lead.png" style="width: 79%;" />
</div>
<div class="slide" id="full-stack-framework">
<h1>Full Stack Framework</h1>
<p>Django comes with:</p>
<ul class="incremental simple">
<li>Persistence via the <em>Django ORM</em></li>
<li>CRUD content editing via the automatic <em>Django Admin</em></li>
<li>URL Mapping via <em>urlpatterns</em></li>
<li>Templating via the <em>Django Template Language</em></li>
<li>Caching with levels of configurability</li>
<li>Internationalization via i18n hooks</li>
<li>Form rendering and handling</li>
</ul>
<p class="incremental">Pretty much everything you need to make a solid website quickly</p>
</div>
<div class="slide" id="what-sets-it-apart">
<h1>What Sets it Apart?</h1>
<p>Lots of frameworks offer some of these features, if not all.</p>
<p class="incremental">What is Django's <em>killer feature</em></p>
<p class="incremental center"><strong>The Django Admin</strong></p>
</div>
<div class="slide" id="the-django-admin">
<h1>The Django Admin</h1>
<p>Works in concert with the Django ORM to provide automatic CRUD functionality</p>
<p class="incremental">You write the models, it provides the UI</p>
<p class="incremental center"><strong>Really</strong></p>
</div>
<div class="slide" id="the-pareto-principle">
<h1>The Pareto Principle</h1>
<p>The Django Admin is a perfect embodiment of the Pareto Priciple, a.k.a. the
80/20 rule:</p>
<p class="incremental center">80% of the problems can be solved by 20% of the effort</p>
<p class="incremental">The converse also holds true:</p>
<p class="incremental center">Fixing the last 20% of the problems will take the remaining 80% of the effort.</p>
</div>
<div class="slide" id="other-django-advantages">
<h1>Other Django Advantages</h1>
<p>Clearly the most popular Python web framework at this time</p>
<p class="incremental">Popularity translates into:</p>
<ul class="incremental simple">
<li>Active, present community</li>
<li>Plethora of good examples to be found online</li>
<li>Rich ecosystem of <em>apps</em> (encapsulated add-on functionality)</li>
</ul>
<p class="incremental center"><strong>Jobs</strong></p>
</div>
<div class="slide" id="active-development">
<h1>Active Development</h1>
<p>Popular frameworks tend to be actively developed.</p>
<p class="incremental">Django releases in the last 12 months:</p>
<ul class="incremental simple">
<li>1.5 (any day now)</li>
<li>1.4.3 (December 2012)</li>
<li>1.3.5 (December 2012)</li>
<li>1.4.2 (November 2012)</li>
<li>1.3.3 (August 2012)</li>
<li>1.4.1 (July 2012)</li>
<li>1.3.2 (July 2012)</li>
<li>1.4 (March 2012)</li>
</ul>
</div>
<div class="slide" id="great-documentation">
<h1>Great Documentation</h1>
<p>Thorough, readable, and discoverable.</p>
<p class="incremental">Led the way to better documentation for all Python</p>
<p class="incremental"><a class="reference external" href="https://readthedocs.org/">Read The Docs</a> - built in connection with
Django, sponsored by the Django Software Foundation.</p>
<p class="incremental">Write documentation as part of your python package, and render new versions of
that documentation for every commit</p>
<p class="incremental center"><strong>this is awesome</strong></p>
</div>
<div class="slide" id="history">
<h1>History</h1>
<p>Django was created to power the website of the Lawrence Journal-World
newspaper, Lawrence, KS</p>
<p class="incremental">This birth in practicality is reflected in the design of the system.</p>
<p class="incremental">Pretty much every design decision was made to solve a real problem.</p>
<p class="incremental">You can read more in <a class="reference external" href="http://www.quora.com/What-is-the-history-of-the-Django-web-framework">this Quora post</a></p>
</div>
<div class="slide" id="django-organization">
<h1>Django Organization</h1>
<p>Django is organized into <em>projects</em> and <em>apps</em></p>
<p class="incremental">A Django <em>project</em> represents the totality of a website, all the pages it
will contain and all the functionality it supports</p>
<p class="incremental">A Django <em>app</em> represents an individual unit of functionality: a blog, a
forum, a registration system, a content tagging system, etc.</p>
<p class="incremental">One <em>project</em> can (and likely will) consist of many <em>apps</em></p>
</div>
<div class="slide" id="starting-a-project">
<h1>Starting a Project</h1>
<p>You should already have done this at home, but we'll look at it together
quickly, in case:</p>
<ul class="incremental simple">
<li>Set up a Django virtualenv</li>
<li>Activate that env and <tt class="docutils literal">pip install django</tt></li>
<li>Create a new Django project:</li>
</ul>
<pre class="code incremental literal-block">
(djangoenv)$ django-admin.py startproject mysite
</pre>
<p class="incremental">This will create a folder called 'mysite'.  Let's take a look at it:</p>
</div>
<div class="slide" id="project-layout">
<h1>Project Layout</h1>
<p>The folder created by <em>django-admin.py</em> contains the following structure:</p>
<pre class="code literal-block">
mysite/
    manage.py
    mysite/
        __init__.py
        settings.py
        urls.py
        wsgi.py
</pre>
<p class="incremental">If what you see doesn't match that, you're using an older version of Django.
Make sure you've installed 1.4.3.</p>
</div>
<div class="slide" id="what-got-created">
<h1>What Got Created</h1>
<ul class="incremental simple">
<li><strong>outer *mysite* folder</strong>: this is just a container and can be renamed or
moved at will</li>
<li><strong>inner *mysite* folder</strong>: this is your project directory. It should not be
renamed.</li>
<li><strong>__init__.py</strong>: magic file that makes <em>mysite</em> a python package.</li>
<li><strong>settings.py</strong>: file which holds configuration for your project, more soon.</li>
<li><strong>urls.py</strong>: file which holds top-level URL configuration for your project,
more soon.</li>
<li><strong>wsgi.py</strong>: the .wsgi file which allows your project to be run in a wsgi
server, like mod_wsgi.</li>
<li><strong>manage.py</strong>: a management control script.</li>
</ul>
</div>
<div class="slide" id="django-admin-py-and-manage-py">
<h1><em>django-admin.py</em> and <em>manage.py</em></h1>
<p><em>django-admin.py</em> provides a hook for administrative tasks and abilities:</p>
<ul class="incremental simple">
<li>creating a new project or app</li>
<li>running the development server</li>
<li>executing tests</li>
<li>entering a python interpreter</li>
<li>entering a database shell session with your database</li>
<li>much much more (run <tt class="docutils literal"><span class="pre">django-admin.py</span></tt> without an argument)</li>
</ul>
<p class="incremental"><em>manage.py</em> wraps this functionality, adding the full environment of your
project.</p>
</div>
<div class="slide" id="development-server">
<h1>Development Server</h1>
<p>At this point, you should be ready to use the development server:</p>
<pre class="literal-block">
(djangoenv)$ cd mysite
(djangoenv)$ python manage.py runserver
...
</pre>
<p class="incremental">Load <tt class="docutils literal"><span class="pre">http://localhost:8000</span></tt> in your browser.</p>
</div>
<div class="slide" id="a-blank-slate">
<h1>A Blank Slate</h1>
<p>You should see this:</p>
<img alt="img/django-start.png" class="align-center" src="img/django-start.png" style="width: 98%;" />
<p class="incremental center"><strong>Do you?</strong></p>
</div>
<div class="slide" id="connecting-a-database">
<h1>Connecting A Database</h1>
<p>Django comes with its own ORM (Object-Relational Mapper)</p>
<p class="incremental">The first step in working with Django is to connect it to your database (this
is set in <tt class="docutils literal">settings.py</tt>)</p>
<pre class="code python small incremental literal-block">
<span class="n">DATABASES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">'default'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">'ENGINE'</span><span class="p">:</span> <span class="s">'django.db.backends.&lt;your_db_backend&gt;'</span><span class="p">,</span>
        <span class="s">'NAME'</span><span class="p">:</span> <span class="s">'&lt;your_db_name&gt;'</span><span class="p">,</span>
        <span class="s">'USER'</span><span class="p">:</span> <span class="s">'&lt;your_db_user&gt;'</span><span class="p">,</span>
        <span class="s">'PASSWORD'</span><span class="p">:</span> <span class="s">'&lt;your_db_password&gt;'</span><span class="p">,</span>
        <span class="s">'HOST'</span><span class="p">:</span> <span class="s">'&lt;not_needed_on_localhost&gt;'</span><span class="p">,</span>
        <span class="s">'PORT'</span><span class="p">:</span> <span class="s">'&lt;not_needed_on_localhost&gt;'</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre>
</div>
<div class="slide" id="a-quick-word-about-databases">
<h1>A Quick Word about Databases</h1>
<p>Sqlite3 is <strong>not</strong> a production-capable database. Do not attempt to use it as
such. Do not start a real project using sqlite3, expecting to move 'when
you go to production'.</p>
<p class="incremental">That being said, proper database administration is out-of-scope for this
class. If you haven't already got a PostgreSQL or MySQL database set up and
ready to use, just use sqlite3 so we can get through this.</p>
</div>
<div class="slide" id="building-db-tables">
<h1>Building DB Tables</h1>
<p>The Django ORM builds tables. Django models describe the objects you want, the
ORM does the rest.</p>
<p class="incremental">Django comes with some <em>apps</em> set up and ready to use. These define models,
and need tables to power them. You create the tables by running the management
command <em>syncdb</em>:</p>
<pre class="incremental literal-block">
(djangoenv)$ python manage.py syncdb
</pre>
<p class="incremental">Add your first admin user when prompted (remember the password)</p>
</div>
<div class="slide" id="lab">
<h1>Lab</h1>
<p>The remainder of our class today will be lab time. We'll be directly playing
with Django from here on out.</p>
<p>Todays lab is drawn from the <a class="reference external" href="https://docs.djangoproject.com/en/1.4/intro/tutorial01/">Django Tutorial</a>, with some minor
adjustments.</p>
</div>
<div class="slide" id="lab-part-one">
<h1>Lab - Part One</h1>
<p>We are going to create an <em>app</em> to add to our <em>project</em>.  This app will:</p>
<ul class="incremental simple">
<li>Allow a user to create poll questions</li>
<li>Allow a user to provide choices for these questions</li>
<li>Allow visitors to a site to see these questions and vote for an answer</li>
<li>Allow the total vote tallies for the answers to a poll question to be
displayed.</li>
</ul>
<p class="incremental">As stated above, an <em>app</em> should represent a unit of functionality within a
larger system, the <em>project</em>.  We have a project, we need to create an <em>app</em></p>
</div>
<div class="slide" id="create-an-app">
<h1>Create an App</h1>
<p>This is accomplished using <tt class="docutils literal">manage.py</tt>.</p>
<p class="incremental">In your terminal, make sure you are in the <em>outer</em> mysite directory, where the
file <tt class="docutils literal">manage.py</tt> is located.  Then:</p>
<pre class="incremental literal-block">
(djangoenv)$ python manage.py startapp polls
</pre>
</div>
<div class="slide" id="what-is-created">
<h1>What is Created</h1>
<p>This should leave you with the following structure:</p>
<pre class="small literal-block">
mysite/
    manage.py
    mysite/
        ...
    polls/
        __init__.py
        models.py
        tests.py
        views.py
</pre>
<p class="incremental">We'll start by defining the objects we will work with: poll questions and
choices.</p>
</div>
<div class="slide" id="models">
<h1>Models</h1>
<p>Open the file <tt class="docutils literal">models.py</tt> in your editor, and add the following code:</p>
<pre class="code python literal-block">
<span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>

<span class="k">class</span> <span class="nc">Poll</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">question</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
    <span class="n">pub_date</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="s">'date published'</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Choice</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">poll</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Poll</span><span class="p">)</span>
    <span class="n">choice</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
    <span class="n">votes</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre>
</div>
<div class="slide" id="model-details">
<h1>Model Details</h1>
<p>Let's look at that a bit more closely:</p>
<pre class="code python small incrmental literal-block">
<span class="k">class</span> <span class="nc">Poll</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</pre>
<!-- class: incremental small -->
<ul class="simple">
<li>Our Models are Python classes that inherit from the Model class</li>
<li>The <tt class="docutils literal">Model</tt> class provides a standard API for interacting with a database,
centered on the object defined by the model.</li>
<li>You can add functionality to your object by adding methods to these models.</li>
<li>Consider methods added to a model to be row-level operations. They will work
on a single record from the database, not on entire tables</li>
<li>You can read much more about the <a class="reference external" href="https://docs.djangoproject.com/en/1.4/ref/models/instances/">Model API</a></li>
</ul>
</div>
<div class="slide" id="field-details">
<h1>Field Details</h1>
<p>A model has attributes defined by <tt class="docutils literal">Fields</tt>:</p>
<pre class="code python small literal-block">
<span class="n">question</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
<span class="n">pub_date</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="s">'date published'</span><span class="p">)</span>
<span class="n">poll</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Poll</span><span class="p">)</span>
<span class="n">votes</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre>
<ul class="incremental small simple">
<li>Fields map to columns in a database table</li>
<li>Note there are no explicit primary key fields. Django does this
automatically</li>
<li>Different field types map to different SQL column types, the ORM handles
this.</li>
<li>Django fields can handle complex relationships between objects.</li>
<li>Field constructors take arguments, some are common to all Fields, others
particular to a given Field type.</li>
<li><strong>ALL</strong> Django model fields default to being NOT NULL (required). You change
this with the <tt class="docutils literal">blank</tt> and <tt class="docutils literal">null</tt> constructor arguments</li>
<li>You can read much more about <a class="reference external" href="https://docs.djangoproject.com/en/1.4/ref/models/fields/">Model Fields</a></li>
</ul>
</div>
<div class="slide" id="hooking-it-up">
<h1>Hooking it Up</h1>
<p>Okay, we've got a couple of models, now we need to add our <em>app</em> to our
project.</p>
<p class="incremental">In Django, this is accomplished by configuration.</p>
<p class="incremental">Configuration takes place in the project <tt class="docutils literal">settings.py</tt> file.</p>
<p class="incremental">Open that file now, in your editor.</p>
</div>
<div class="slide" id="installing-apps">
<h1>Installing Apps</h1>
<p>You extend Django functionality by <em>installing apps</em>. Find the following block
in <tt class="docutils literal">settings.py</tt> and edit it like so:</p>
<pre class="code python small literal-block">
<span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s">'django.contrib.auth'</span><span class="p">,</span>
    <span class="s">'django.contrib.contenttypes'</span><span class="p">,</span>
    <span class="s">'django.contrib.sessions'</span><span class="p">,</span>
    <span class="s">'django.contrib.sites'</span><span class="p">,</span>
    <span class="s">'django.contrib.messages'</span><span class="p">,</span>
    <span class="s">'django.contrib.staticfiles'</span><span class="p">,</span>
    <span class="c"># Uncomment the next line to enable the admin:</span>
    <span class="c"># 'django.contrib.admin',</span>
    <span class="c"># Uncomment the next line to enable admin documentation:</span>
    <span class="c"># 'django.contrib.admindocs',</span>
    <span class="s">'polls'</span><span class="p">,</span> <span class="c"># &lt;- YOU ADD THIS PART</span>
<span class="p">)</span>
</pre>
</div>
<div class="slide" id="setting-up-the-database">
<h1>Setting Up the Database</h1>
<p>By now, we should have some guess as to what the next step will be</p>
<pre class="code incremental literal-block">
(djangoenv)$ python manage.py syncdb
</pre>
<p class="incremental">This will execute the SQL commands needed to create the new tables in your
database.</p>
</div>
<div class="slide" id="a-word-about-development">
<h1>A Word About Development</h1>
<p>These models we've created are not going to change. This is unusual for a
development cycle.</p>
<p class="incremental">The <tt class="docutils literal">syncdb</tt> management command only creates tables that <em>do not yet exist</em>.
It <strong>does not update tables</strong>.</p>
<p class="incremental">It is easy to get your model definitions out of sync with your database.</p>
<p class="incremental">Django provides the management command <tt class="docutils literal">sqlclear</tt> to handle this. It drops
all tables, so you can run <tt class="docutils literal">syncdb</tt> again.</p>
</div>
<div class="slide" id="ack">
<h1>ACK!!!</h1>
<p class="center">That doesn't sound very nice, does it?</p>
<p class="big-centered incremental">We'll learn a better way next week</p>
</div>
<div class="slide" id="the-django-shell">
<h1>The Django Shell</h1>
<p>Django provides a management command <tt class="docutils literal">shell</tt>:</p>
<ul class="incremental simple">
<li>Shares the same <tt class="docutils literal">sys.path</tt> as your project, so all installed python
packages are present.</li>
<li>Imports the <tt class="docutils literal">settings.py</tt> file from your project, and so shares all
installed apps and other settings.</li>
<li>Handles connections to your database, so you can interact with live data
directly.</li>
</ul>
<p class="incremental">Let's explore the Model Instance API directly using this shell</p>
</div>
<div class="slide" id="model-instance-api">
<h1>Model Instance API</h1>
<pre class="literal-block">
(djangoenv)$ python manage.py shell
</pre>
<pre class="code python literal-block">
<span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">polls.models</span> <span class="kn">import</span> <span class="n">Poll</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">Poll</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="mi">0</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">p1</span> <span class="o">=</span> <span class="n">Poll</span><span class="p">(</span><span class="n">question</span><span class="o">=</span><span class="s">&quot;What is your name?&quot;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">p1</span><span class="o">.</span><span class="n">full_clean</span><span class="p">()</span>
<span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
  <span class="o">...</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">django.utils</span> <span class="kn">import</span> <span class="n">timezone</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">p1</span><span class="o">.</span><span class="n">pub_date</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">p1</span><span class="o">.</span><span class="n">full_clean</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">p1</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">Poll</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="mi">1</span>
</pre>
</div>
<div class="slide" id="more-api">
<h1>More API</h1>
<pre class="code python small literal-block">
<span class="o">&gt;&gt;&gt;</span> <span class="n">Poll</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="p">[</span><span class="o">&lt;</span><span class="n">Poll</span><span class="p">:</span> <span class="n">Poll</span> <span class="nb">object</span><span class="o">&gt;</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">what_polls</span> <span class="o">=</span> <span class="n">Poll</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">question__startswith</span><span class="o">=</span><span class="s">&quot;What&quot;</span><span class="p">)</span>
<span class="p">[</span><span class="o">&lt;</span><span class="n">Poll</span><span class="p">:</span> <span class="n">Poll</span> <span class="nb">object</span><span class="o">&gt;</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">mypoll</span> <span class="o">=</span> <span class="n">Poll</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">mypoll</span><span class="o">.</span><span class="n">choice_set</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="p">[]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">polls.models</span> <span class="kn">import</span> <span class="n">Choice</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">c1</span> <span class="o">=</span> <span class="n">Choice</span><span class="p">(</span><span class="n">choice</span><span class="o">=</span><span class="s">&quot;King Arthur of the Britons&quot;</span><span class="p">,</span> <span class="n">poll</span><span class="o">=</span><span class="n">mypoll</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">c1</span><span class="o">.</span><span class="n">save</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">mypoll</span><span class="o">.</span><span class="n">choice_set</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="p">[</span><span class="o">&lt;</span><span class="n">Choice</span><span class="p">:</span> <span class="n">Choice</span> <span class="nb">object</span><span class="o">&gt;</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">mypoll</span><span class="o">.</span><span class="n">choice_set</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">choice</span><span class="o">=</span><span class="s">&quot;Lancelot of Camelot&quot;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">mypoll</span><span class="o">.</span><span class="n">choice_set</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="p">[</span><span class="o">&lt;</span><span class="n">Choice</span><span class="p">:</span> <span class="n">Choice</span> <span class="nb">object</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">Choice</span><span class="p">:</span> <span class="n">Choice</span> <span class="nb">object</span><span class="o">&gt;</span><span class="p">]</span>
</pre>
</div>
<div class="slide" id="enhancing-models">
<h1>Enhancing Models</h1>
<p>It's clear that the representation of our objects leaves something to be
desired. Django can help</p>
<p class="incremental">Back in <tt class="docutils literal">models.py</tt>, add these methods:</p>
<pre class="code python small incremental literal-block">
<span class="k">class</span> <span class="nc">Poll</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="c"># ...</span>
    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">question</span>

<span class="k">class</span> <span class="nc">Choice</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="c"># ...</span>
    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">choice</span>
</pre>
</div>
<div class="slide" id="model-methods">
<h1>Model Methods</h1>
<p>This <tt class="docutils literal">__unicode__</tt> method is a normal python instance method. You can add
other methods, too (still <tt class="docutils literal">models.py</tt>):</p>
<pre class="code python small incremental literal-block">
<span class="kn">from</span> <span class="nn">django.utils</span> <span class="kn">import</span> <span class="n">timezone</span>

<span class="k">class</span> <span class="nc">Poll</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="c"># ...</span>
    <span class="k">def</span> <span class="nf">published_today</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="n">time_delta</span> <span class="o">=</span> <span class="n">now</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">pub_date</span>
        <span class="k">return</span> <span class="n">time_delta</span><span class="o">.</span><span class="n">days</span> <span class="o">==</span> <span class="mi">0</span>
</pre>
<p class="incremental">Save that, then start up the Django shell again (<tt class="docutils literal">python manage.py shell</tt>)</p>
</div>
<div class="slide" id="check-custom-methods">
<h1>Check Custom Methods</h1>
<pre class="code python literal-block">
<span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">polls.models</span> <span class="kn">import</span> <span class="n">Poll</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">mypoll</span> <span class="o">=</span> <span class="n">Poll</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">mypoll</span>
<span class="o">&lt;</span><span class="n">Poll</span><span class="p">:</span> <span class="n">What</span> <span class="ow">is</span> <span class="n">your</span> <span class="n">name</span><span class="err">?</span><span class="o">&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">mypoll</span><span class="o">.</span><span class="n">choice_set</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="p">[</span><span class="o">&lt;</span><span class="n">Choice</span><span class="p">:</span> <span class="n">King</span> <span class="n">Arthur</span> <span class="n">of</span> <span class="n">the</span> <span class="n">Britons</span><span class="o">&gt;</span><span class="p">,</span>
 <span class="o">&lt;</span><span class="n">Choice</span><span class="p">:</span> <span class="n">Lancelot</span> <span class="n">of</span> <span class="n">Camelot</span><span class="o">&gt;</span><span class="p">,</span>
 <span class="o">&lt;</span><span class="n">Choice</span><span class="p">:</span> <span class="n">Robin</span> <span class="n">of</span> <span class="n">Camelot</span><span class="o">&gt;</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">mypoll</span><span class="o">.</span><span class="n">published_today</span><span class="p">()</span>
<span class="bp">True</span>
</pre>
</div>
<div class="slide" id="testing-our-models">
<h1>Testing Our Models</h1>
<p>As with any project, we want to test our work. Django provides a testing
framework to allow this.</p>
<p class="incremental">Django supports both <em>unit tests</em> and <em>doctests</em>. I strongly suggest using
<em>unit tests</em>.</p>
<p class="incremental">You add tests for your <em>app</em> to the file <tt class="docutils literal">tests.py</tt>, which should be at the
same package level as <tt class="docutils literal">models.py</tt>.</p>
<p class="incremental">Locate and open this file in your editor.  We are going to add a few tests for
the models we've just written.</p>
</div>
<div class="slide" id="testing-setup">
<h1>Testing Setup</h1>
<pre class="code python small literal-block">
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">timedelta</span>

<span class="kn">from</span> <span class="nn">django.test</span> <span class="kn">import</span> <span class="n">TestCase</span>
<span class="kn">from</span> <span class="nn">django.utils</span> <span class="kn">import</span> <span class="n">timezone</span>

<span class="kn">from</span> <span class="nn">polls.models</span> <span class="kn">import</span> <span class="n">Poll</span>

<span class="k">class</span> <span class="nc">PollTest</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expected_question</span> <span class="o">=</span> <span class="s">&quot;what is the question?&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expected_choice</span> <span class="o">=</span> <span class="s">&quot;do you like spongecake?&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">poll</span> <span class="o">=</span> <span class="n">Poll</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
            <span class="n">question</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">expected_question</span><span class="p">,</span>
            <span class="n">pub_date</span><span class="o">=</span><span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">choice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">poll</span><span class="o">.</span><span class="n">choice_set</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
            <span class="n">choice</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">expected_choice</span><span class="p">)</span>
</pre>
</div>
<div class="slide" id="writing-tests">
<h1>Writing Tests</h1>
<pre class="code python small literal-block">
<span class="k">def</span> <span class="nf">test_poll_display</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">unicode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">poll</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">expected_question</span><span class="p">)</span>
    <span class="n">new_question</span> <span class="o">=</span> <span class="s">&quot;What is the answer?&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">poll</span><span class="o">.</span><span class="n">question</span> <span class="o">=</span> <span class="n">new_question</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">unicode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">poll</span><span class="p">),</span> <span class="n">new_question</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">test_choice_display</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">unicode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">choice</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">expected_choice</span><span class="p">)</span>
    <span class="n">new_choice</span> <span class="o">=</span> <span class="s">&quot;is left better than right?&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">choice</span><span class="o">.</span><span class="n">choice</span> <span class="o">=</span> <span class="n">new_choice</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">unicode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">choice</span><span class="p">),</span> <span class="n">new_choice</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">test_published_today</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">poll</span><span class="o">.</span><span class="n">published_today</span><span class="p">())</span>
    <span class="n">delta</span> <span class="o">=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">26</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">poll</span><span class="o">.</span><span class="n">pub_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">poll</span><span class="o">.</span><span class="n">pub_date</span> <span class="o">-</span> <span class="n">delta</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">poll</span><span class="o">.</span><span class="n">published_today</span><span class="p">())</span>
</pre>
</div>
<div class="slide" id="running-tests">
<h1>Running Tests</h1>
<p>You can run your tests using a management command provided by Django:</p>
<pre class="literal-block">
(djangoenv)$ python manage.py test polls
</pre>
<ul class="incremental simple">
<li>This will run the tests for the <tt class="docutils literal">polls</tt> app</li>
<li>You can provide the name of any installed app</li>
<li>If you provide no name, the tests for <em>all</em> installed apps will run</li>
<li>You can run subsets by providing dotted names: <tt class="docutils literal">polls.PollTest</tt>,
<tt class="docutils literal">polls.PollTest.test_poll_display</tt></li>
</ul>
<p class="incremental">There is a lot more to know about <a class="reference external" href="https://docs.djangoproject.com/en/1.4/topics/testing/">Testing Django applications</a></p>
</div>
<div class="slide" id="what-to-test">
<h1>What to Test</h1>
<p>In any framework, the question arises of what exactly to test. Much of the
functioning of your app is provided by framework tools. Do you need to test
that stuff?</p>
<p class="incremental">I <em>usually</em> don't write tests covering features provided directly by the
framework.</p>
<p class="incremental">I <em>do</em> write tests for functionality I add, and for places where I make
changes to how the default functionality works.</p>
<p class="incremental">This is largely a matter of style and taste (and of how much development time
you have).</p>
</div>
<div class="slide" id="lab-part-two">
<h1>Lab - Part Two</h1>
<p>In this part, we'll be adding our app to the Django Admin.  This will allow
us to add, edit and delete objects with a minimum of work.</p>
<p>We'll focus instead on how to customize the admin to get the best results we
can.</p>
</div>
<div class="slide" id="install-the-admin">
<h1>Install the Admin</h1>
<p>The Django Admin is, itself, an <em>app</em>. It is not installed by default.</p>
<p class="incremental">Open the <tt class="docutils literal">settings.py</tt> file from our <tt class="docutils literal">mysite</tt> project package and uncomment
the admin bit:</p>
<pre class="code python incremental small literal-block">
<span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">(</span>
    <span class="c"># ...</span>
    <span class="s">'django.contrib.staticfiles'</span><span class="p">,</span>
    <span class="c"># Uncomment the next line to enable the admin:</span>
    <span class="s">'django.contrib.admin'</span><span class="p">,</span> <span class="c"># &lt;- THIS LINE HERE</span>
    <span class="c"># Uncomment the next line to enable admin documentation:</span>
    <span class="c"># 'django.contrib.admindocs',</span>
    <span class="s">'polls'</span><span class="p">,</span>
<span class="p">)</span>
</pre>
</div>
<div class="slide" id="add-the-admin-tables">
<h1>Add the Admin Tables</h1>
<p>As you might expect, enabling the admin alters our DB. We'll need to run
the <tt class="docutils literal">syncdb</tt> management command:</p>
<pre class="literal-block">
(djangoenv)$ python manage.py syncdb
Creating tables ...
Creating table django_admin_log
Installing custom SQL ...
Installing indexes ...
Installed 0 object(s) from 0 fixture(s)
</pre>
<p class="incremental">All set.  Let's add URLs next</p>
</div>
<div class="slide" id="django-url-resolution">
<h1>Django URL Resolution</h1>
<p>Like Flas, Django has a system for routing URLs to code: the <em>urlconf</em>.</p>
<ul class="incremental simple">
<li>a urlconf is a list of mappings</li>
<li>each mapping has a regexp <em>rule</em>, representing the URL</li>
<li>each mapping names or provides the <tt class="docutils literal">callable</tt> to be invoked</li>
<li>each mapping can have a <em>name</em>, used to <em>reverse</em> the URL</li>
<li>a urlconf should be created using functions from the <tt class="docutils literal">django.conf.urls</tt>
module</li>
<li>django will load the urlconf named <tt class="docutils literal">urlpatterns</tt> that it finds in the file
named in <tt class="docutils literal">settings.ROOT_URLCONF</tt>.</li>
<li>That urlconf must include any others it requires</li>
</ul>
</div>
<div class="slide" id="django-url-patterns">
<h1>Django URL Patterns</h1>
<p>Open the file <tt class="docutils literal">urls.py</tt> from your <tt class="docutils literal">mysite</tt> project package:</p>
<pre class="code python literal-block">
<span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="kn">import</span> <span class="n">patterns</span><span class="p">,</span> <span class="n">include</span><span class="p">,</span> <span class="n">url</span>
<span class="o">...</span>
<span class="n">urlpatterns</span> <span class="o">=</span> <span class="n">patterns</span><span class="p">(</span><span class="s">''</span><span class="p">,</span>
    <span class="c"># list of url patterns</span>
<span class="p">)</span>
</pre>
<p class="incremental">You can include lists of urls from installed apps by using the <tt class="docutils literal">include</tt>
function as the callable in a url pattern:</p>
<pre class="code python incremental literal-block">
<span class="n">url</span><span class="p">(</span><span class="s">r'^blog/'</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s">'my.blog.app.urls'</span><span class="p">))</span>
</pre>
</div>
<div class="slide" id="including-the-admin">
<h1>Including the Admin</h1>
<p>Using this knowledge, we can add <em>all</em> the URLs provided by the Django admin
in one stroke. Edit <tt class="docutils literal">urls.py</tt>, which is open in your editor, and uncomment
three lines:</p>
<pre class="code python incremental literal-block">
<span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span> <span class="c">#&lt;- Uncomment these two</span>
<span class="n">admin</span><span class="o">.</span><span class="n">autodiscover</span><span class="p">()</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="n">patterns</span><span class="p">(</span><span class="s">''</span><span class="p">,</span>

    <span class="c"># Uncomment the next line to enable the admin:</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r'^admin/'</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">urls</span><span class="p">)),</span> <span class="c">#&lt;- and this</span>
<span class="p">)</span>
</pre>
</div>
<div class="slide" id="using-the-development-server">
<h1>Using the Development Server</h1>
<p>We can now view the admin.  We'll use the Django development server.</p>
<p class="incremental">In your terminal, use the <tt class="docutils literal">runserver</tt> management command to start the
development server:</p>
<pre class="incremental literal-block">
(djangoenv)$ python manage.py runserver
Validating models...

0 errors found
Django version 1.4.3, using settings 'mysite.settings'
Development server is running at http://127.0.0.1:8000/
Quit the server with CONTROL-C.
</pre>
</div>
<div class="slide" id="viewing-the-admin">
<h1>Viewing the Admin</h1>
<p>Load <tt class="docutils literal"><span class="pre">http://localhost:8000/</span></tt>.  You should see this:</p>
<img alt="img/django-admin-login.png" class="align-center" src="img/django-admin-login.png" style="width: 50%;" />
<p class="incremental">Login with the name and password you created before.</p>
</div>
<div class="slide" id="the-admin-index">
<h1>The Admin Index</h1>
<p>The index will provide a list of all the installed <em>apps</em> and each model
registered.  You should see this:</p>
<img alt="img/admin_index.png" class="align-center" src="img/admin_index.png" style="width: 90%;" />
<p class="incremental">Click on <tt class="docutils literal">Users</tt>. Find yourself? Edit yourself, but <strong>don't</strong> uncheck
<tt class="docutils literal">superuser</tt>.</p>
</div>
<div class="slide" id="add-polls-to-the-admin">
<h1>Add Polls to the Admin</h1>
<p>Okay, let's add our app, and the models therein, to the admin.</p>
<p class="incremental">Add a new file to the <tt class="docutils literal">polls</tt> app package: <tt class="docutils literal">admin.py</tt>. Edit it and add the
following:</p>
<pre class="code python incremental literal-block">
<span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
<span class="kn">from</span> <span class="nn">polls.models</span> <span class="kn">import</span> <span class="n">Poll</span><span class="p">,</span> <span class="n">Choice</span>

<span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">Poll</span><span class="p">)</span>
<span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">Choice</span><span class="p">)</span>
</pre>
<p class="incremental">Restart your Development server and reload the admin index</p>
</div>
<div class="slide" id="customized-admin">
<h1>Customized Admin</h1>
<p>The Django Admin displays <tt class="docutils literal">ModelAdmin</tt> instances for any models that are
registered</p>
<ul class="incremental simple">
<li>The object <tt class="docutils literal">admin.site</tt> is a global instance of the <tt class="docutils literal">Admin</tt> class.</li>
<li>Each call to <tt class="docutils literal">admin.site.register</tt> adds a new model to the global <em>site</em></li>
<li><tt class="docutils literal">register</tt> takes two args: a <em>Model</em> subclass and a <em>ModelAdmin</em> subclass</li>
<li>If you call it with only the <em>Model</em> subclass, the <em>ModelAdmin</em> is
automatically generated.</li>
<li>You can create, and customize, a <em>ModelAdmin</em> subclass for your models.</li>
</ul>
</div>
<div class="slide" id="create-a-polladmin">
<h1>Create a PollAdmin</h1>
<p>In <tt class="docutils literal">admin.py</tt> add the following code (above the calls to <tt class="docutils literal">register</tt>):</p>
<pre class="code python literal-block">
<span class="k">class</span> <span class="nc">PollAdmin</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="n">list_display</span> <span class="o">=</span> <span class="p">(</span><span class="s">'pub_date'</span><span class="p">,</span> <span class="s">'question'</span><span class="p">,</span>
                    <span class="s">'published_today'</span><span class="p">)</span>
    <span class="n">list_filter</span> <span class="o">=</span> <span class="p">(</span><span class="s">'pub_date'</span><span class="p">,</span> <span class="p">)</span>
    <span class="n">ordering</span> <span class="o">=</span> <span class="p">(</span><span class="s">'pub_date'</span><span class="p">,</span> <span class="p">)</span>
</pre>
<p class="incremental">Then add this new class to the <tt class="docutils literal">register</tt> call for our <tt class="docutils literal">Poll</tt>:</p>
<pre class="code python incremental literal-block">
<span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">Poll</span><span class="p">,</span> <span class="n">PollAdmin</span><span class="p">)</span>
</pre>
</div>
<div class="slide" id="more-convenient-relations">
<h1>More Convenient Relations</h1>
<p>In our Admin site, you can see the <tt class="docutils literal">Poll</tt> to which a <tt class="docutils literal">Choice</tt> belongs.</p>
<p class="incremental">It'd be a lot nicer to be able to manage the <tt class="docutils literal">Choices</tt> for a <tt class="docutils literal">Poll</tt> from
the poll admin page, wouldn't it?</p>
<p class="incremental">The Django Admin provides a special type of <tt class="docutils literal">ModelAdmin</tt> for just this
purpose: The <tt class="docutils literal">InlineModelAdmin</tt>.</p>
<p class="incremental">There are two flavors, <em>stacked</em> and <em>tabular</em>. The <em>tabular</em> version is more
compact as it displays each related object in a single table row.</p>
</div>
<div class="slide" id="create-a-choice-inline">
<h1>Create a Choice Inline</h1>
<p>Add the following code <em>above</em> our <tt class="docutils literal">PollAdmin</tt> class in <tt class="docutils literal">admin.py</tt>:</p>
<pre class="code python literal-block">
<span class="k">class</span> <span class="nc">ChoiceInline</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">TabularInline</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Choice</span>
    <span class="n">extra</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">ordering</span> <span class="o">=</span> <span class="p">(</span><span class="s">'choice'</span><span class="p">,</span> <span class="p">)</span>
</pre>
<p>Then, add the inline to <tt class="docutils literal">PollAdmin</tt>:</p>
<pre class="code python literal-block">
<span class="k">class</span> <span class="nc">PollAdmin</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="c"># ...</span>
    <span class="n">inlines</span> <span class="o">=</span> <span class="p">(</span><span class="n">ChoiceInline</span><span class="p">,</span> <span class="p">)</span>
</pre>
</div>
<div class="slide" id="method-attributes-for-the-admin">
<h1>Method Attributes for the Admin</h1>
<p>For example, methods of a class you use in the admin can have special
attributes that alter how it works. Make these changes to <tt class="docutils literal">models.py</tt></p>
<pre class="code python literal-block">
<span class="k">class</span> <span class="nc">Poll</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="o">...</span>
    <span class="k">def</span> <span class="nf">published_today</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="n">time_delta</span> <span class="o">=</span> <span class="n">now</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">pub_date</span>
        <span class="k">return</span> <span class="n">time_delta</span><span class="o">.</span><span class="n">days</span> <span class="o">==</span> <span class="mi">0</span>
    <span class="n">published_today</span><span class="o">.</span><span class="n">boolean</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">published_today</span><span class="o">.</span><span class="n">short_description</span> <span class="o">=</span> <span class="s">&quot;Published Today?&quot;</span>
</pre>
</div>
<div class="slide" id="reap-the-rewards">
<h1>Reap the Rewards</h1>
<p>Good work. You've set up a fully functional CRUD admin interface for your
application database in about 25 lines of code.</p>
<p class="incremental">Play with it for a bit.</p>
</div>
<div class="slide" id="lab-part-three">
<h1>Lab - Part Three</h1>
<p>In this part, we'll add public views and set up a way for visitors to vote
in our poll.</p>
<p>Along the way, we'll learn a bit about Django's <em>Generic Views</em> and the
<em>Django Templating Language</em></p>
</div>
<div class="slide" id="django-views">
<h1>Django Views</h1>
<p>Django views are callables that take a request and return a response.</p>
<p class="incremental">From the beginning, these have been functions.  They still can be.</p>
<p class="incremental">Version 1.3 added support for Class-based Views.</p>
<p class="incremental">Really, they've always been there implicitly. The Admin is just a big
class-based view.</p>
</div>
<div class="slide" id="generic-views">
<h1>Generic Views</h1>
<p>One of the most common uses for Class-based Views is in creating Generic Views.</p>
<p class="incremental">Some public views are so common that providing a simple and generic interface
for making them is a big win.</p>
<ul class="incremental simple">
<li>Showing a list of objects of some type.</li>
<li>Showing the details of a single object of some type.</li>
<li>Displaying a static HTML template (or a template with some dynamic context)</li>
<li>Displaying and processing a simple HTML form.</li>
</ul>
</div>
<div class="slide" id="our-application">
<h1>Our Application</h1>
<p>We'd like to be able to add some views that show our polls to the public.</p>
<p class="incremental">What views would we like to have?</p>
<ul class="incremental simple">
<li>A list of all polls, perhaps ordered by publication date</li>
<li>A display of a single poll, showing each choice and allowing a vote</li>
<li>A view that processes a vote</li>
<li>A view that shows the poll results after you vote.</li>
</ul>
<p class="incremental">I start by configuring my URLs, it helps me think about the app API.</p>
</div>
<div class="slide" id="configure-urls">
<h1>Configure URLs</h1>
<p>In your <tt class="docutils literal">polls</tt> app package, add a new file: <tt class="docutils literal">urls.py</tt>. Open it in an
editor:</p>
<pre class="code python incremental small literal-block">
<span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="kn">import</span> <span class="n">patterns</span><span class="p">,</span> <span class="n">url</span>
<span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">HttpResponse</span>

<span class="k">def</span> <span class="nf">stub</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s">'stub view'</span><span class="p">,</span> <span class="n">mimetype</span><span class="o">=</span><span class="s">&quot;text/plain&quot;</span><span class="p">)</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="n">patterns</span><span class="p">(</span><span class="s">''</span><span class="p">,</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r'^$'</span><span class="p">,</span> <span class="n">stub</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;poll_list&quot;</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r'^(?P&lt;pk&gt;\d+)/$'</span><span class="p">,</span> <span class="n">stub</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;poll_detail&quot;</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r'^(?P&lt;pk&gt;\d+)/vote/$'</span> <span class="n">stub</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;poll_vote&quot;</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r'^(?P&lt;pk&gt;\d+)/result/$'</span><span class="p">,</span> <span class="n">stub</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;poll_result&quot;</span><span class="p">),</span>
<span class="p">)</span>
</pre>
</div>
<div class="slide" id="hook-urls-to-the-root">
<h1>Hook URLs to the Root</h1>
<p>Like with the Django Admin, we can now add all the urls for our poll app at
once.</p>
<p class="incremental">In the <tt class="docutils literal">urls.py</tt> in our <tt class="docutils literal">mysite</tt> project package, add the following:</p>
<pre class="code python incremental small literal-block">
<span class="n">urlpatterns</span> <span class="o">=</span> <span class="n">patterns</span><span class="p">(</span><span class="s">''</span><span class="p">,</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r'^admin/'</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">urls</span><span class="p">)),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r'^polls/'</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s">'polls.urls'</span><span class="p">)),</span> <span class="c"># ADD</span>
<span class="p">)</span>
</pre>
<p class="incremental">Restart the development server and load <tt class="docutils literal"><span class="pre">http://localhost:8000/polls/</span></tt></p>
</div>
<div class="slide" id="generic-poll-list">
<h1>Generic Poll List</h1>
<p>Django's Generic Views allow you to do quite a lot with just a little code.
Edit <tt class="docutils literal">urls.py</tt>:</p>
<pre class="code python incremental small literal-block">
<span class="c"># add this import</span>
<span class="kn">from</span> <span class="nn">django.views.generic</span> <span class="kn">import</span> <span class="n">ListView</span>

<span class="c"># edit the url pattern for the poll list:</span>
<span class="n">url</span><span class="p">(</span><span class="s">r'^$'</span><span class="p">,</span>
    <span class="n">ListView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span>
        <span class="n">queryset</span><span class="o">=</span><span class="n">Poll</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">'-pub_date'</span><span class="p">)[:</span><span class="mi">5</span><span class="p">],</span>
        <span class="n">context_object_name</span><span class="o">=</span><span class="s">'polls'</span><span class="p">,</span>
        <span class="n">template_name</span><span class="o">=</span><span class="s">&quot;polls/list.html&quot;</span>
    <span class="p">),</span>
    <span class="n">name</span><span class="o">=</span><span class="s">&quot;poll_list&quot;</span><span class="p">),</span>
</pre>
<p class="incremental">Now, we just need to make that template</p>
</div>
<div class="slide" id="django-templates">
<h1>Django Templates</h1>
<p>The <a class="reference external" href="https://docs.djangoproject.com/en/1.4/topics/templates/">Django Template Language</a> looks a <em>lot</em> like
Jinja2. It is, however, quite a bit more limited.</p>
<ul class="incremental simple">
<li>variables available in context may be printed with <tt class="docutils literal">{{ name }}</tt></li>
<li>variables that are objects or dictionaries may be addressed with dots: <tt class="docutils literal">{{
name.attr }}</tt></li>
<li><em>filters</em> are available and look the same <tt class="docutils literal">{{ name|upper }}</tt></li>
<li>logical <em>tags</em>: <tt class="docutils literal">{% for x in y <span class="pre">%}{{</span> x <span class="pre">}}{%</span> endfor %}</tt></li>
<li>available filters and tags may be extended with custom code</li>
<li>templates can be <em>extended</em> and <em>included</em></li>
<li>you may define <em>blocks</em> in templates to be filled by other templates.</li>
<li>you <strong>may not</strong> execute arbitrary python or assign variables and use them</li>
</ul>
</div>
<div class="slide" id="setting-up">
<h1>Setting Up</h1>
<p>In <tt class="docutils literal">assignments/week06/lab/source</tt> you'll find a file <tt class="docutils literal">base.html</tt>.</p>
<p class="incremental">Create a new directory, <tt class="docutils literal">templates</tt> in your <tt class="docutils literal">polls</tt> app package.</p>
<p class="incremental">Copy the <tt class="docutils literal">base.html</tt> file into that new directory.</p>
<p class="incremental">Next, create a folder <tt class="docutils literal">polls</tt> <em>inside</em> that new templates directory. We'll
add our individual templates here.</p>
</div>
<div class="slide" id="list-template">
<h1>List Template</h1>
<p>Add <tt class="docutils literal">list.html</tt> inside <tt class="docutils literal">templates/polls</tt>:</p>
<pre class="code django small literal-block">
<span class="cp">{%</span> <span class="k">extends</span> <span class="s2">&quot;base.html&quot;</span> <span class="cp">%}</span><span class="x">

</span><span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span><span class="x">
&lt;h1&gt;Latest Polls&lt;/h1&gt;
</span><span class="cp">{%</span> <span class="k">for</span> <span class="nv">poll</span> <span class="k">in</span> <span class="nv">polls</span> <span class="cp">%}</span><span class="x">
&lt;div class=&quot;poll&quot;&gt;
  &lt;h2&gt;&lt;a href=&quot;</span><span class="cp">{%</span> <span class="k">url</span> <span class="nv">poll_detail</span> <span class="nv">poll.pk</span> <span class="cp">%}</span><span class="x">&quot;&gt;</span><span class="cp">{{</span> <span class="nv">poll</span> <span class="cp">}}</span><span class="x">&lt;/a&gt;&lt;/h2&gt;
&lt;/div&gt;
</span><span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span><span class="x">
</span><span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre>
<p class="incremental">Now, load <tt class="docutils literal"><span class="pre">http://localhost:8000/polls/</span></tt> again.</p>
</div>
<div class="slide" id="detail-view">
<h1>Detail View</h1>
<p>Back in our <tt class="docutils literal">polls</tt> app, let's edit <tt class="docutils literal">urls.py</tt> again:</p>
<pre class="code python incremental small literal-block">
<span class="c"># add this import</span>
<span class="kn">from</span> <span class="nn">django.views.generic</span> <span class="kn">import</span> <span class="n">ListView</span>

<span class="c"># and edit the detail url like so:</span>
<span class="n">url</span><span class="p">(</span><span class="s">r'^(?P&lt;pk&gt;\d+)/$'</span><span class="p">,</span>
    <span class="n">DetailView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span>
        <span class="n">model</span><span class="o">=</span><span class="n">Poll</span><span class="p">,</span>
        <span class="n">template_name</span><span class="o">=</span><span class="s">&quot;polls/detail.html&quot;</span>
    <span class="p">),</span>
    <span class="n">name</span><span class="o">=</span><span class="s">&quot;poll_detail&quot;</span><span class="p">),</span>
</pre>
<p class="incremental">Again, we only need to add a template.</p>
</div>
<div class="slide" id="forms-in-django">
<h1>Forms in Django</h1>
<p>We want to be able to vote on a poll.</p>
<p class="incremental">Because doing so involves changing data on the server, we should do this with
a POST request.</p>
<p class="incremental">An html form is a simple way to allow us to force a POST request.</p>
<p class="incremental">Data-altering requests are vulnerable to Cross-Site Request Forgery, a common
attack vector.</p>
</div>
<div class="slide" id="danger-csrf">
<h1>Danger: CSRF</h1>
<p>Django not only provides a convenient system to fight this, it <em>requires</em> it
for any POST requests.</p>
<p class="incremental">The Django middleware that does this is enabled by default. All you need to do
is include the {% csrf_token %} tag in your form template.</p>
<p class="incremental">Create a new file <tt class="docutils literal">detail.html</tt> in your <tt class="docutils literal">templates/polls</tt> directory</p>
</div>
<div class="slide" id="detail-template">
<h1>Detail Template</h1>
<pre class="code django small literal-block">
<span class="cp">{%</span> <span class="k">extends</span> <span class="s2">&quot;base.html&quot;</span> <span class="cp">%}</span><span class="x">
</span><span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span><span class="x">
&lt;h1&gt;</span><span class="cp">{{</span> <span class="nv">poll</span> <span class="cp">}}</span><span class="x">&lt;/h1&gt;
</span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">poll.choice_set.count</span> <span class="o">&gt;</span> <span class="m">0</span> <span class="cp">%}</span><span class="x">
&lt;form action=&quot;</span><span class="cp">{%</span> <span class="k">url</span> <span class="nv">poll_vote</span> <span class="nv">poll.pk</span> <span class="cp">%}</span><span class="x">&quot; method=&quot;POST&quot;&gt;
  </span><span class="cp">{%</span> <span class="k">csrf_token</span> <span class="cp">%}</span><span class="x">
  </span><span class="cp">{%</span> <span class="k">for</span> <span class="nv">choice</span> <span class="k">in</span> <span class="nv">poll.choice_set.all</span> <span class="cp">%}</span><span class="x">
  &lt;div class=&quot;choice&quot;&gt;
    &lt;label for=&quot;choice_</span><span class="cp">{{</span> <span class="nv">choice.pk</span> <span class="cp">}}</span><span class="x">&quot;&gt;
      &lt;input type=&quot;radio&quot; name=&quot;choice&quot; id=&quot;choice_</span><span class="cp">{{</span> <span class="nv">choice.pk</span> <span class="cp">}}</span><span class="x">&quot;
             value=&quot;</span><span class="cp">{{</span> <span class="nv">choice.pk</span> <span class="cp">}}</span><span class="x">&quot;/&gt;
      </span><span class="cp">{{</span> <span class="nv">choice</span> <span class="cp">}}</span><span class="x">&lt;/label&gt;&lt;/div&gt;
  </span><span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span><span class="x">
  &lt;input type=&quot;submit&quot; name=&quot;vote&quot; value=&quot;Vote&quot;/&gt;
&lt;/form&gt;
</span><span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span><span class="x">
&lt;p&gt;No choices are available for this poll&lt;/p&gt;
</span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span><span class="x">
</span><span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre>
</div>
<div class="slide" id="processing-the-vote">
<h1>Processing The Vote</h1>
<p>We can now submit a form to the <tt class="docutils literal">poll_vote</tt> url. We need to process that
vote</p>
<p class="incremental">Here, a class-based generic view is just going to get in our way.  Let's use
an old-fashioned view function.</p>
<p class="incremental">How is our user's vote reaching the server?</p>
<p class="incremental">It gets there as POST data, the value for the key 'choice'.</p>
</div>
<div class="slide" id="django-get-and-post-data">
<h1>Django GET and POST Data</h1>
<p>Django provides the same type of Request/Response based interaction model that
most frameworks are based on. Views are called with the first argument being a
<tt class="docutils literal">request</tt> object.</p>
<p class="incremental">request.GET and request.POST are dictionary-like objects containing data
parsed from incoming HTTP request.</p>
<p class="incremental">You can use normal dictionary syntax to read values from these:</p>
<pre class="code python incremental small literal-block">
<span class="n">bar</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">'bucko'</span><span class="p">]</span>
<span class="n">foo</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'somevar'</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
</pre>
</div>
<div class="slide" id="vote-view-skeleton">
<h1>Vote View Skeleton</h1>
<p>In <tt class="docutils literal">views.py</tt> from our <tt class="docutils literal">polls</tt> app package:</p>
<pre class="code python small literal-block">
<span class="kn">from</span> <span class="nn">django.core.urlresolvers</span> <span class="kn">import</span> <span class="n">reverse</span>
<span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">HttpResponseRedirect</span>

<span class="k">def</span> <span class="nf">vote_view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">pk</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">&quot;POST&quot;</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c"># attempt to get a choice</span>
        <span class="k">except</span> <span class="n">NoGoodChoice</span><span class="p">:</span> <span class="c"># send back to detail</span>
            <span class="n">url</span> <span class="o">=</span> <span class="n">reverse</span><span class="p">(</span><span class="s">'poll_detail'</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">pk</span><span class="p">,</span> <span class="p">])</span>
        <span class="k">else</span><span class="p">:</span> <span class="c"># vote and send to result</span>
            <span class="n">url</span> <span class="o">=</span> <span class="n">reverse</span><span class="p">(</span><span class="s">'poll_result'</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">pk</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span> <span class="c"># submitted via GET, ignore it</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">reverse</span><span class="p">(</span><span class="s">'poll_detail'</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">pk</span><span class="p">,</span> <span class="p">])</span>

    <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</pre>
</div>
<div class="slide" id="get-the-choice">
<h1>Get the Choice</h1>
<p>Let's start by filling out the process of getting the choice:</p>
<pre class="code python small literal-block">
<span class="c"># add imports</span>
<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">get_object_or_404</span>
<span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">messages</span>
<span class="kn">from</span> <span class="nn">polls.models</span> <span class="kn">import</span> <span class="n">Poll</span><span class="p">,</span> <span class="n">Choice</span>
<span class="c"># and edit our skeleton</span>
<span class="k">def</span> <span class="nf">vote_view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">pk</span><span class="p">):</span>
    <span class="n">poll</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Poll</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">pk</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">&quot;POST&quot;</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">choice</span> <span class="o">=</span> <span class="n">poll</span><span class="o">.</span><span class="n">choice_set</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="n">pk</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'choice'</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="k">except</span> <span class="n">Choice</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Ooops, pick a choice that exists, please&quot;</span>
            <span class="n">messages</span><span class="o">.</span><span class="n">add_message</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">messages</span><span class="o">.</span><span class="n">ERROR</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
            <span class="n">url</span> <span class="o">=</span> <span class="n">reverse</span><span class="p">(</span><span class="s">'poll_detail'</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">pk</span><span class="p">,</span> <span class="p">])</span>
</pre>
</div>
<div class="slide" id="add-a-vote">
<h1>Add a Vote</h1>
<p>Next, let's record a vote on our choice:</p>
<pre class="code python small literal-block">
<span class="k">def</span> <span class="nf">vote_view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">pk</span><span class="p">):</span>
    <span class="o">...</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c"># choice = ...</span>
    <span class="k">except</span> <span class="n">Choice</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
        <span class="c"># ...</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">choice</span><span class="o">.</span><span class="n">votes</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">choice</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="n">messages</span><span class="o">.</span><span class="n">add_message</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">messages</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span>
                             <span class="s">&quot;You voted for </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">choice</span><span class="p">)</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">reverse</span><span class="p">(</span><span class="s">'poll_result'</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">pk</span><span class="p">])</span>
</pre>
</div>
<div class="slide" id="add-the-url">
<h1>Add the URL</h1>
<p>Finally, we need to add this view to our urlconf. Back in <tt class="docutils literal">urls.py</tt> in the
<tt class="docutils literal">polls</tt> app package, edit the url for the voting view like so:</p>
<pre class="code python small literal-block">
<span class="n">url</span><span class="p">(</span><span class="s">r'^(?P&lt;pk&gt;\d+)/vote/$'</span><span class="p">,</span>
    <span class="s">'polls.views.vote_view'</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s">&quot;poll_vote&quot;</span><span class="p">),</span>
</pre>
<p class="incremental">Notice that the 'callable' in this pattern is a string. Django allows you to
use this sort of <em>dotted name</em> reference. It will resolve it (or throw an
error if it can't)</p>
</div>
<div class="slide" id="display-result">
<h1>Display Result</h1>
<p>The last view we need is the poll result. This can simply be a different
version of the Generic DetailView. Still in <tt class="docutils literal">urls.py</tt> edit the pattern for
the results view:</p>
<pre class="code python small literal-block">
<span class="n">url</span><span class="p">(</span><span class="s">r'^(?P&lt;pk&gt;\d+)/result/$'</span><span class="p">,</span>
    <span class="n">DetailView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span>
        <span class="n">model</span><span class="o">=</span><span class="n">Poll</span><span class="p">,</span>
        <span class="n">template_name</span><span class="o">=</span><span class="s">&quot;polls/result.html&quot;</span><span class="p">),</span>
    <span class="n">name</span><span class="o">=</span><span class="s">&quot;poll_result&quot;</span><span class="p">)</span>
</pre>
<p class="incremental">And, of course, we will need to create that final template</p>
</div>
<div class="slide" id="result-template">
<h1>Result Template</h1>
<p>In <tt class="docutils literal">templates/polls</tt> create a new file, <tt class="docutils literal">result.html</tt>:</p>
<pre class="code django small literal-block">
<span class="cp">{%</span> <span class="k">extends</span> <span class="s2">&quot;base.html&quot;</span> <span class="cp">%}</span><span class="x">

</span><span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span><span class="x">
&lt;h1&gt;</span><span class="cp">{{</span> <span class="nv">poll</span> <span class="cp">}}</span><span class="x">&lt;/h1&gt;
&lt;ul&gt;
  </span><span class="cp">{%</span> <span class="k">for</span> <span class="nv">choice</span> <span class="k">in</span> <span class="nv">poll.choice_set.all</span> <span class="cp">%}</span><span class="x">
  &lt;li&gt;</span><span class="cp">{{</span> <span class="nv">choice</span> <span class="cp">}}</span><span class="x"> (</span><span class="cp">{{</span><span class="nv">choice.votes</span><span class="cp">}}</span><span class="x"> votes)&lt;/li&gt;
  </span><span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span><span class="x">
&lt;/ul&gt;
&lt;a href=&quot;</span><span class="cp">{%</span> <span class="k">url</span> <span class="nv">poll_list</span> <span class="cp">%}</span><span class="x">&quot;&gt;Back to the polls, please&lt;/a&gt;
</span><span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre>
</div>
<div class="slide" id="play-a-bit">
<h1>Play a Bit</h1>
<p>Alright. You've done it.</p>
<p>Take a few minutes to add some polls in the Admin.</p>
<p>Then return to the public side and vote. See how it goes.</p>
</div>
<div class="slide" id="next-week">
<h1>Next Week</h1>
<p>We are going to mix it up quite a bit this week.</p>
<p class="incremental">I would like you all to divide into teams. Each team should have 4-6 people.
Each team should have both experienced and inexperienced members. Try to match
up with people whose strengths are different from your own.</p>
<p class="incremental">Now, each team, pick a 'facilitator'. This person will be responsible for
managing the operation of the team. This person will help to ensure that each
team member has a task. This should be a more experienced team member.</p>
</div>
<div class="slide" id="assignment">
<h1>Assignment</h1>
<p>During this week, each <strong>non-leader member</strong> will duplicate the Flaskr app
using Django.</p>
<ul class="incremental simple">
<li>Create a new <em>app</em> which will hold all the code required.</li>
<li>Define the model for the 'entry' object.</li>
<li>Extend that model with two additional fields: <tt class="docutils literal">publication_date</tt>
(DateTimeField), and <tt class="docutils literal">author</tt> (ForeignKey to
<tt class="docutils literal">django.contrib.auth.models.User</tt>)</li>
<li>Define the URLs you'll need (an entry list, a form processor)</li>
<li>Define the Views you'll need (see the two above).</li>
</ul>
</div>
<div class="slide" id="id1">
<h1>Assignment</h1>
<p>During this week, each <strong>team leader</strong> will communicate with me to build a
plan for implementing a new feature for the Django flaskr app.</p>
<ul class="incremental simple">
<li>User Registration</li>
<li>'Archive' views based on date or author</li>
<li>WYSIWYG visual editor for entry posts.</li>
<li>Tagging</li>
<li>Theme (make it beautiful)</li>
<li>Search (this is a bigger one than you might think)</li>
</ul>
</div>
<div class="slide" id="submitting-the-assignment">
<h1>Submitting the Assignment</h1>
<p>Leaders, you will communicate with me to make a plan</p>
<p>Members, you will do the usual submission of your code.</p>
<p>DO NOT ATTEMPT TO GET YOUR CODE RUNNING ON A VM</p>
</div>
<div class="slide" id="id2">
<h1>Next Week</h1>
<p>Our class next week will be a little different. Each team will be implementing
a new feature for our micro-blog application.</p>
<p>We will work in teams for the entire class up until 8:30, when we will show
off our results.</p>
</div>
</div>
</body>
</html>
