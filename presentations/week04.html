<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.9.1: http://docutils.sourceforge.net/" />
<meta name="version" content="S5 1.1" />
<title></title>
<link rel="stylesheet" href="ui/uw_pce_theme/pretty.css" type="text/css" />
<!-- configuration parameters -->
<meta name="defaultView" content="slideshow" />
<meta name="controlVis" content="hidden" />
<!-- style sheet links -->
<script src="ui/uw_pce_theme/slides.js" type="text/javascript"></script>
<link rel="stylesheet" href="ui/uw_pce_theme/slides.css"
      type="text/css" media="projection" id="slideProj" />
<link rel="stylesheet" href="ui/uw_pce_theme/outline.css"
      type="text/css" media="screen" id="outlineStyle" />
<link rel="stylesheet" href="ui/uw_pce_theme/print.css"
      type="text/css" media="print" id="slidePrint" />
<link rel="stylesheet" href="ui/uw_pce_theme/opera.css"
      type="text/css" media="projection" id="operaFix" />
</head>
<body>
<div class="layout">
<div id="controls"></div>
<div id="currentSlide"></div>
<div id="header">

</div>
<div id="footer">
<h2><a class="reference external" href="http://github.com/cewing/training.python_web">View document source</a>.
</h2>
</div>
</div>
<div class="presentation">
<div class="slide" id="slide0">



</div>
<div class="slide" id="give-wsgi-something-to-do">
<h1>Give WSGI Something To Do</h1>
<p>We've set Apache to look in <tt class="docutils literal"><span class="pre">/usr/lib/wsgi-bin/</span></tt> for wsgi scripts. We need
to make that directory since it doesn't exist by default:</p>
<pre class="literal-block">
$ sudo mkdir /usr/lib/wsgi-bin
</pre>
<p class="incremental">On your local machine find the <tt class="docutils literal">wsgi_test.py</tt> file in
<tt class="docutils literal">assignments/week04/lab/</tt>. Use <tt class="docutils literal">scp</tt> to move it to your home directory on
the VM. Then on the VM:</p>
<pre class="incremental small literal-block">
$ sudo cp ~/wsgi_test.py /usr/lib/wsgi-bin/
$ ls -l /usr/lib/wsgi-bin/
total 4
-rwxr-xr-x 1 root root 955 Jan 22 00:06 wsgi_test.py
</pre>
</div>
<div class="slide" id="reload-apache">
<h1>Reload Apache</h1>
<p>Any time you change Apache configuration, you need to restart to pick up the
changes.  First, you should check your work to avoid
crashing Apache:</p>
<pre class="literal-block">
$ apache2ctl configtest
Syntax OK
</pre>
<p class="incremental">Okay, our syntax is good, no problems there.  Let's restart:</p>
<pre class="incremental literal-block">
$ sudo /etc/init.d/apache2 graceful
* Reloading web server config apache2           [ OK ]
</pre>
<p class="incremental">Hit <a class="reference external" href="http://YOUR_VM.blueboxgrid.com/wsgi-bin/wsgi_test.py">http://YOUR_VM.blueboxgrid.com/wsgi-bin/wsgi_test.py</a> with your browser.</p>
</div>
<div class="slide" id="looking-at-wsgi-test-py">
<h1>Looking at wsgi_test.py</h1>
<pre class="code python tiny literal-block">
<span class="c">#!/usr/bin/python</span>

<span class="c"># This is our application object. It could have any name,</span>
<span class="c"># except when using mod_wsgi where it must be &quot;application&quot;</span>
<span class="k">def</span> <span class="nf">application</span><span class="p">(</span><span class="n">environ</span><span class="p">,</span> <span class="n">start_response</span><span class="p">):</span>

    <span class="c"># build the response body possibly using the environ dictionary</span>
    <span class="n">response_body</span> <span class="o">=</span> <span class="s">'The request method was </span><span class="si">%s</span><span class="s">'</span> <span class="o">%</span> <span class="n">environ</span><span class="p">[</span><span class="s">'REQUEST_METHOD'</span><span class="p">]</span>

    <span class="c"># HTTP response code and message</span>
    <span class="n">status</span> <span class="o">=</span> <span class="s">'200 OK'</span>

    <span class="c"># These are HTTP headers expected by the client.</span>
    <span class="c"># They must be wrapped as a list of tupled pairs:</span>
    <span class="c"># [(Header name, Header value)].</span>
    <span class="n">response_headers</span> <span class="o">=</span> <span class="p">[(</span><span class="s">'Content-Type'</span><span class="p">,</span> <span class="s">'text/plain'</span><span class="p">),</span>
                        <span class="p">(</span><span class="s">'Content-Length'</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">response_body</span><span class="p">)))]</span>

    <span class="c"># Send them to the server using the supplied function</span>
    <span class="n">start_response</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="n">response_headers</span><span class="p">)</span>

    <span class="c"># Return the response body.</span>
    <span class="c"># Notice it is wrapped in a list although it could be any iterable.</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">response_body</span><span class="p">]</span>
</pre>
</div>
<div class="slide" id="lab-2">
<h1>Lab 2</h1>
<p>Let's repeat what we did for CGI with WSGI:</p>
<ul class="incremental simple">
<li>In <tt class="docutils literal">assignments/week04/lab/src</tt> you will find the file
<tt class="docutils literal">lab2_wsgi_template.py</tt>.</li>
<li>Copy that file to <tt class="docutils literal"><span class="pre">assignments/week04/lab/wsgi-bin/lab2_wsgi.py</span></tt> (note the
missing '_template' part)</li>
<li>The script contains some html with text naming elements of the WSGI
environment.</li>
<li>Use elements of <tt class="docutils literal">environ</tt> to fill in the blanks.</li>
<li>You can test and debug changes <em>locally</em> by running the script (<tt class="docutils literal">python
lab2_wsgi.py</tt>) and then pointing your browser to <tt class="docutils literal">localhost:8080</tt></li>
</ul>
<p class="incremental center"><strong>GO</strong></p>
</div>
<div class="slide" id="assignment">
<h1>Assignment</h1>
<p>Using what you've learned this week, Attempt the following:</p>
<ul class="incremental simple">
<li>Create a small, multi-page WSGI application</li>
<li>Use <tt class="docutils literal">assignments/week04/athome/bookdb.py</tt> as a data source</li>
<li>Your app index page should list the books in the db</li>
<li>Each listing should supply a link to a detail page</li>
<li>Each detail page should list information about the book</li>
</ul>
<p class="incremental">Use the Armin Ronacher reading from the class outline as a source for hints:
<a class="reference external" href="http://lucumr.pocoo.org/2007/5/21/getting-started-with-wsgi/">http://lucumr.pocoo.org/2007/5/21/getting-started-with-wsgi/</a></p>
</div>
<div class="slide" id="submitting-the-assignment">
<h1>Submitting the Assignment</h1>
<p>This week we are going to do something a bit different. Get your application
running on your VM. Then add the following to <tt class="docutils literal">assignments/week04/athome</tt>
and submit a pull request:</p>
<ul class="simple">
<li>A README.txt file containing the URL I can visit to see your application.
You can also put questions or comments in this file.</li>
<li>Your source code, whatever is up on your VM.</li>
</ul>
</div>
</div>
</body>
</html>
