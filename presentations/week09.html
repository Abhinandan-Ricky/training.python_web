<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.9.1: http://docutils.sourceforge.net/" />
<meta name="version" content="S5 1.1" />
<title>Internet Programming with Python</title>
<link rel="stylesheet" href="ui/uw_pce_theme/pretty.css" type="text/css" />
<!-- configuration parameters -->
<meta name="defaultView" content="slideshow" />
<meta name="controlVis" content="hidden" />
<!-- style sheet links -->
<script src="ui/uw_pce_theme/slides.js" type="text/javascript"></script>
<link rel="stylesheet" href="ui/uw_pce_theme/slides.css"
      type="text/css" media="projection" id="slideProj" />
<link rel="stylesheet" href="ui/uw_pce_theme/outline.css"
      type="text/css" media="screen" id="outlineStyle" />
<link rel="stylesheet" href="ui/uw_pce_theme/print.css"
      type="text/css" media="print" id="slidePrint" />
<link rel="stylesheet" href="ui/uw_pce_theme/opera.css"
      type="text/css" media="projection" id="operaFix" />
</head>
<body>
<div class="layout">
<div id="controls"></div>
<div id="currentSlide"></div>
<div id="header">

</div>
<div id="footer">
<h1>Internet Programming with Python</h1>
<h2><a class="reference external" href="http://github.com/cewing/training.python_web">View document source</a>.
</h2>
</div>
</div>
<div class="presentation">
<div class="slide" id="slide0">
<h1 class="title">Internet Programming with Python</h1>

<img alt="img/cloud_cover.jpg" class="align-left" src="img/cloud_cover.jpg" style="width: 50%;" />
<p>Week 9: The Cloud</p>
<div class="intro-blurb right line-block">
<div class="line">Every cloud has its silver lining</div>
<div class="line">but it is sometimes a little difficult</div>
<div class="line">to get it to the mint.</div>
<div class="line">--Don Marquis</div>
</div>
<p class="image-credit">image: mnsc <a class="reference external" href="http://www.flickr.com/photos/mnsc/2768391365/">http://www.flickr.com/photos/mnsc/2768391365/</a> - CC-BY</p>

</div>
<div class="slide" id="deployment">
<h1>Deployment</h1>
<p>You've built your app, tested it, now it's time to <em>go live</em></p>
<p class="incremental">What are your options?</p>
<p class="incremental center"><strong>It Depends</strong></p>
</div>
<div class="slide" id="the-traditional-way">
<h1>The Traditional Way</h1>
<p>In the old daysâ„¢ you had one option</p>
<p class="incremental">Buy a server, build it and host it yourself</p>
<p class="incremental">You have total control</p>
<ul class="incremental small simple">
<li>buy exactly the hardware you want</li>
<li>run only the services you need</li>
</ul>
<p class="incremental">You <em>also</em> have total responsibility</p>
<ul class="incremental small simple">
<li>when something breaks, you have to fix it</li>
<li>you bear <em>all</em> the costs yourself</li>
</ul>
</div>
<div class="slide" id="traditional-drawbacks">
<h1>Traditional Drawbacks</h1>
<p>Expensive</p>
<ul class="incremental simple">
<li>Server-class hardware $2k-$10k or more</li>
<li>Systems Administrator $90K/year</li>
</ul>
<p class="incremental">Inefficient</p>
<ul class="incremental simple">
<li>Most web sites don't get enough traffic to tax a good server</li>
<li>Web traffic tends to be assymetrical</li>
<li>Systems administration tasks also highly assymetrical</li>
</ul>
<p class="incremental">A problem of resource utilization</p>
</div>
<div class="slide" id="the-first-solution">
<h1>The First Solution</h1>
<p>VPS (<em>Virtual Private Server</em>)</p>
<p class="incremental">A part of a server (or perhaps an entire server) purchased from a provider.</p>
<p class="incremental">You pay for only a portion of a server and a portion of a systems
administrator.</p>
<p class="incremental">You retain control of the system</p>
<p class="incremental">You also retain responsibility for everything above the bare iron.</p>
</div>
<div class="slide" id="vps-outcomes">
<h1>VPS Outcomes</h1>
<p>Benefits</p>
<ul class="incremental simple">
<li>Reduced cost ($30-$100+/month vs server and salary)</li>
<li>Reduced burden (The provider handles hardware upkeep and low-level
maintenance)</li>
<li>Retain control of your full software stack</li>
</ul>
<p class="incremental">Drawbacks</p>
<ul class="incremental simple">
<li>You install and maintain the web stack (requires knowledge)</li>
<li>You lose control over resource utilization</li>
<li>Your resources are still fixed (always the same size)</li>
</ul>
</div>
<div class="slide" id="the-second-solution">
<h1>The Second Solution</h1>
<p>Shared Hosting</p>
<p class="incremental">You pay a provider to set you up with a [django/flask/pyramid/etc.] system.</p>
<p class="incremental">Hardware and most software maintenance is provided</p>
<p class="incremental">You are able to install some (but perhaps not all) add-ons</p>
<p class="incremental">This solution is very popular in the PHP world</p>
<p class="incremental">Much less so with Python.  Why?...</p>
</div>
<div class="slide" id="shared-hosting-outcomes">
<h1>Shared Hosting Outcomes</h1>
<p>Benefits</p>
<ul class="incremental simple">
<li>Enormously less expensive ($5-$15+/month)</li>
<li>Much lower maintenance burden</li>
<li>Simplified installation process</li>
</ul>
<p class="incremental">Drawbacks</p>
<ul class="incremental simple">
<li>Tight resource restrictions (cpu, ram, disk space)</li>
<li>Little to no control over most of the stack</li>
<li>Reduced availability of some frameworks or packages</li>
</ul>
<p class="incremental">And still, no ability to grow if you need</p>
</div>
<div class="slide" id="the-third-solution">
<h1>The Third Solution</h1>
<p class="big-centered incremental"><strong>The Cloud</strong></p>
<p class="incremental center small">(<em>cue fanfare</em>)</p>
</div>
<div class="slide" id="the-cloud-concept">
<h1>The Cloud Concept</h1>
<p>You don't know today what you will need tomorrow</p>
<p class="incremental">Today your website is getting 100-500 unique visitors</p>
<p class="incremental">Tomorrow you might have 10,000, 100,000.  Who knows?</p>
<p class="incremental">Should you have to buy enough hardware to handle that traffic today?</p>
<p class="incremental">Cloud computing offers rapid deployment solutions so you can scale at will</p>
</div>
<div class="slide" id="what-is-the-cloud">
<h1>What is 'the Cloud'?</h1>
<p>Really, it differs from place to place.</p>
<p class="incremental">Some are more do-it-yourself (Amazon EC2, Rackspace Cloud)</p>
<p class="incremental">Some are more automated (Heroku, Elastic Beanstalk, AppEngine)</p>
<p class="incremental">All try to abstract common deployment tasks to make it easy to repeat</p>
<p class="incremental">So, how does that work?</p>
</div>
<div class="slide" id="fabric">
<h1>Fabric</h1>
<p>Fabric is <em>not</em> a cloud service. Instead, it's a tool built to help developers
simplify the process of deploying complex apps to a server.</p>
<p class="incremental">It can be used in any setup where you have <tt class="docutils literal">ssh</tt> access to the filesystem
of the remote server.</p>
<p class="incremental">Your classmate Austin used it a couple of weeks back to deploy Django to his
bluebox VM.</p>
<p class="incremental">Today, he's going to share that experience with you...</p>
</div>
<div class="slide" id="heroku">
<h1>Heroku</h1>
<img alt="img/heroku-logo.png" class="align-center" src="img/heroku-logo.png" style="width: 50%;" />
<p class="incremental center">I tried a number of cloud providers</p>
<p class="incremental center">This was hands-down the easiest.</p>
</div>
<div class="slide" id="heroku-sign-up">
<h1>Heroku - Sign-up</h1>
<p>You'll need a Heroku account to do anything, so the first step is to get that</p>
<p class="incremental">Go to <a class="reference external" href="http://www.heroku.com">http://www.heroku.com</a></p>
<p class="incremental">Click on 'Sign Up' and enter your email address</p>
<p class="incremental">When the email arrives, click the link and create your password</p>
<p class="incremental">Once you've signed up, you'll see your 'dashboard' page with tips on getting
started.</p>
</div>
<div class="slide" id="heroku-setup">
<h1>Heroku - Setup</h1>
<p>Like pretty much all the 'cloud' providers out there, Heroku has some
command-line tools you need to use.</p>
<p class="incremental">You can find them at <a class="reference external" href="https://toolbelt.heroku.com/">https://toolbelt.heroku.com/</a></p>
<p class="incremental">Download and install the package, and then login:</p>
<pre class="incremental literal-block">
$ heroku login
Email: your-email&#64;your.domain.com
Password: &lt;fill it in&gt;
</pre>
<p class="incremental">The tool will find, or help you create, an ssh public key</p>
</div>
<div class="slide" id="heroku-branch-my-app">
<h1>Heroku - Branch my App</h1>
<p>As an exercise, I decided to deploy the <em>djangor</em> micro-blog app we created in
class.</p>
<p class="incremental">The first step was to clone the app, then create a local branch for deployment:</p>
<pre class="incremental small literal-block">
$ mkdir heroku-test
$ cd heroku-test
$ git clone git&#64;github.com:cewing/training.django_microblog.git
...
$ cd training.django_microblog
$ git checkout -b heroku-deploy
Switched to a new branch 'heroku-deploy'
$
</pre>
</div>
<div class="slide" id="heroku-setup-virtualenv">
<h1>Heroku - Setup Virtualenv</h1>
<p>Again, like many cloud providers Heroku uses virtualenvs to ensure it's
installed correctly</p>
<p class="incremental">I set up a python 2.7 virtualenv right in my git repository:</p>
<pre class="incremental small literal-block">
$ ~/pythons/bin/virtualenv-2.7 --distribute venv
...
$ source venv/bin/activate
(venv)$
</pre>
<p class="incremental">I don't want to check that virtualenv into git, so I add <tt class="docutils literal">venv</tt> to my
.gitignore file.</p>
<p class="incremental">That way, git will ignore that directory and everything in it.</p>
</div>
<div class="slide" id="heroku-install-dependencies">
<h1>Heroku - Install Dependencies</h1>
<p>For Heroku to work, it needs to know what packages you'll need installed.</p>
<p class="incremental">We can use <tt class="docutils literal">pip</tt> to take care of this:</p>
<pre class="incremental small literal-block">
(venv)$ pip install Django=1.4.5 psycopg2 dj-database-url
</pre>
<p class="incremental">Psycopg2 is a DBAPI connector for PostgreSQL.  Heroku requires Postgresql</p>
<p class="incremental"><tt class="docutils literal"><span class="pre">dj-database-url</span></tt> allows the Django DB settings to come from an <tt class="docutils literal">env</tt> variable.</p>
</div>
<div class="slide" id="heroku-freeze-dependencies">
<h1>Heroku - Freeze Dependencies</h1>
<p>Heroku uses <tt class="docutils literal">pip</tt> too. It uses a file called <tt class="docutils literal">requirements.txt</tt> to know
what to do.</p>
<p class="incremental">You create that file:</p>
<pre class="incremental small literal-block">
(venv)$ pip freeze &gt; requirements.txt
</pre>
<p class="incremental">Then, add the file to your repository and commit:</p>
<pre class="incremental small literal-block">
(venv)$ git add requirements.txt
(venv)$ git commit -m &quot;setting requirements for heroku&quot;
</pre>
</div>
<div class="slide" id="heroku-django-settings">
<h1>Heroku - Django Settings</h1>
<p>To adapt Django to the Heroku environment, we need to add the following to the
end of our <tt class="docutils literal">settings.py</tt> file:</p>
<pre class="code python incremental small literal-block">
<span class="c"># Parse database configuration from $DATABASE_URL</span>
<span class="kn">import</span> <span class="nn">dj_database_url</span>
<span class="n">DATABASES</span><span class="p">[</span><span class="s">'default'</span><span class="p">]</span> <span class="o">=</span>  <span class="n">dj_database_url</span><span class="o">.</span><span class="n">config</span><span class="p">()</span>

<span class="c"># Honor the 'X-Forwarded-Proto' header for request.is_secure()</span>
<span class="n">SECURE_PROXY_SSL_HEADER</span> <span class="o">=</span> <span class="p">(</span><span class="s">'HTTP_X_FORWARDED_PROTO'</span><span class="p">,</span> <span class="s">'https'</span><span class="p">)</span>
</pre>
<p class="incremental">Commit these changes to your heroku-deploy branch.</p>
<p class="incremental">Local development settings are different. You can <a class="reference external" href="http://stackoverflow.com/questions/5159852/managing-multiple-settings-py-files">use different settings for
production and development</a></p>
</div>
<div class="slide" id="heroku-procfile">
<h1>Heroku - Procfile</h1>
<p>Finally, we need to create a file named <tt class="docutils literal">Procfile</tt>.</p>
<p class="incremental">Heroku uses this to learn about the processes we want running.</p>
<p class="incremental">Lines in the file take the form <em>process_type</em>: <em>command</em>,</p>
<p class="incremental">Create the file <tt class="docutils literal">Procfile</tt> and add the following text:</p>
<p class="incremental small">web: python manage.py runserver 0.0.0.0:$PORT --noreload</p>
<p class="incremental small">Then, add and commit that file to the repository.</p>
</div>
<div class="slide" id="heroku-create-and-deploy">
<h1>Heroku - Create and Deploy</h1>
<p>At this point, we're ready to go.</p>
<p class="incremental">First, we create a new <tt class="docutils literal">app</tt> in heroku with our repo:</p>
<pre class="incremental small literal-block">
(venv)$ heroku create
Creating fierce-plains-6505... done, stack is cedar
http://fierce-plains-6505.herokuapp.com/ | git&#64;heroku.com:fierce-plains-6505.git
Git remote heroku added
(venv)$
</pre>
<p class="incremental">Then, deploy it by 'pushing' to the heroku remote (master branch):</p>
<pre class="incremental small literal-block">
(venv)$ git push heroku heroku-deploy:master
</pre>
</div>
<div class="slide" id="heroku-what-happens">
<h1>Heroku - What Happens</h1>
<p>Heroku works like github, in a way.</p>
<p class="incremental">When our repository is <em>pushed</em>, a hook script detects the update and starts
working.</p>
<ul class="incremental simple">
<li>Heroku <a class="reference external" href="https://devcenter.heroku.com/articles/buildpacks">detects</a> that we
are building a python project</li>
<li>A python virtualenv is created</li>
<li><tt class="docutils literal">pip</tt> installs the dependencies in <tt class="docutils literal">requirements.txt</tt></li>
<li>Heroku further detects that we are building a Django app and runs
<tt class="docutils literal">collectstatic</tt></li>
<li>Our <tt class="docutils literal">Procfile</tt> is read, and data about the processes we want is written to
the environment</li>
</ul>
</div>
<div class="slide" id="heroku-syncdb">
<h1>Heroku - Syncdb</h1>
<p>Heroku will not run syncdb for us.  We have to do that on our own.</p>
<p class="incremental">Heroku <em>does</em> provide us with a way to run one-off commands on our server, though:</p>
<pre class="incremental literal-block">
(venv)$ heroku run python manage.py syncdb
</pre>
<p class="incremental">This command is run through an ssh tunnel. We can interact with it.</p>
<p class="incremental">We can use other commands, like <tt class="docutils literal">shell</tt> with <tt class="docutils literal">heroku run</tt>.</p>
</div>
<div class="slide" id="heroku-reap-the-rewards">
<h1>Heroku - Reap the Rewards</h1>
<p>All we have to do now is start a process so we can see our work:</p>
<pre class="incremental small literal-block">
(venv)$ heroku ps:scale web=1
Scaling web processes... done, now running 1
(venv)$ heroku ps
=== web: `python manage.py runserver 0.0.0.0:$PORT --noreload`
web.1: up 2013/03/05 06:28:13 (~ 21m ago)
(venv)$ heroku open
</pre>
<p class="incremental">That last bit will automatically open a web browser pointing at the URL where
may be seen.</p>
</div>
<div class="slide" id="heroku-dns">
<h1>Heroku - DNS</h1>
<p>Heroku does not want you to point A record DNS names at it's services.
<tt class="docutils literal">www.mydomain.com</tt> is okay, but <tt class="docutils literal">mydomain.com</tt> is not.</p>
<p class="incremental">They also don't want you to use IP addresses, since their architecture means
IP addresses change.</p>
<p class="incremental">I set up a CNAME record for <tt class="docutils literal">microblog.crisewing.com</tt>. It points to the URL
opened when I type <tt class="docutils literal">heroku open</tt>.</p>
<p class="incremental">So long as I keep this heroku <tt class="docutils literal">app</tt>, that domain name will not change.</p>
</div>
<div class="slide" id="clean-up">
<h1>Clean-up</h1>
<p>This is but one example of a cloud deployment.</p>
<p class="incremental">It is considerably easier to do than most other cloud deployments.</p>
<p class="incremental">It is also considerably more constrained than other deployments.</p>
</div>
<div class="slide" id="take-away">
<h1>Take-away</h1>
<p>When you are making choices about deployment, you <strong>must</strong> take into
consideration your needs, both now and in the future:</p>
<ul class="incremental simple">
<li>What type of Framework will you use?</li>
<li>What type of Database will you use?</li>
<li>What growth do you expect to experience (best and worst case)?</li>
<li>How much control do you want over <em>all</em> the processes that make your website
run?</li>
<li>How much time/expertise do you have (or can you afford to acquire)?</li>
</ul>
<p class="incremental">Carefully consider these questions, and you will find an appropriate solution.</p>
</div>
<div class="slide" id="lab-time">
<h1>Lab Time</h1>
<p>For the rest of today, we work on your projects.</p>
</div>
</div>
</body>
</html>
